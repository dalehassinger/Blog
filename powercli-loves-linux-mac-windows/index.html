<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>PowerCLI on Mac, Linux, and Windows - vCROCS</title><meta name="Description" content="Enterprise Automation, Monitoring and Logging. Plus more..."><meta property="og:url" content="https://www.vcrocs.info/powercli-loves-linux-mac-windows/">
  <meta property="og:site_name" content="vCROCS">
  <meta property="og:title" content="PowerCLI on Mac, Linux, and Windows">
  <meta property="og:description" content="Home Lab Automation!">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-02-21T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-02-21T00:00:00+00:00">
    <meta property="article:tag" content="VCF">
    <meta property="article:tag" content="Automation">
    <meta property="article:tag" content="PowerShell">
    <meta property="article:tag" content="PowerCLI">
    <meta property="article:tag" content="VMware Code Coach">
    <meta property="article:tag" content="VMware VExpert">
    <meta property="og:image" content="https://www.vcrocs.info/powercli-loves-linux-mac-windows/featured-image.png">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://www.vcrocs.info/powercli-loves-linux-mac-windows/featured-image.png">
  <meta name="twitter:title" content="PowerCLI on Mac, Linux, and Windows">
  <meta name="twitter:description" content="Home Lab Automation!">
      <meta name="twitter:site" content="@dalehassinger">
<meta name="application-name" content="vCROCS">
<meta name="apple-mobile-web-app-title" content="vCROCS"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="canonical" href="https://www.vcrocs.info/powercli-loves-linux-mac-windows/" /><link rel="prev" href="https://www.vcrocs.info/vcf-automation-input-array/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css"></noscript><link rel="preload" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "PowerCLI on Mac, Linux, and Windows",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/www.vcrocs.info\/powercli-loves-linux-mac-windows\/"
        },"image": [{
                            "@type": "ImageObject",
                            "url": "https:\/\/www.vcrocs.info\/powercli-loves-linux-mac-windows\/featured-image.png",
                            "width":  1420 ,
                            "height":  708 
                        }],"genre": "posts","keywords": "VCF, Automation, PowerShell, PowerCLI, VMware Code Coach, VMware vExpert","wordcount":  2135 ,
        "url": "https:\/\/www.vcrocs.info\/powercli-loves-linux-mac-windows\/","datePublished": "2025-02-21T00:00:00+00:00","dateModified": "2025-02-21T00:00:00+00:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
            "@type": "Organization",
            "name": "xxxx","logo": {
                    "@type": "ImageObject",
                    "url": "https:\/\/www.vcrocs.info\/images\/avatar.png",
                    "width":  528 ,
                    "height":  560 
                }},"author": {
                "@type": "Person",
                "name": "Dale Hassinger"
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7670183691519835" crossorigin="anonymous"></script>
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="vCROCS"><span class="header-title-pre"><i class='far fa-house fa-solid'></i></span>vCROCS</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/about/"> About </a><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="/categories/"> Categories </a><a class="menu-item" href="/links/" title="Links"><i class='fab fa-bookmark fa-regular' aria-hidden='true'></i>  </a><a class="menu-item" href="/pics/" title="Pics"><i class='fab fa-image fa-regular' aria-hidden='true'></i>  </a><a class="menu-item" href="https://twitter.com/dalehassinger" title="Twitter" rel="noopener noreffer" target="_blank"><i class='fab fa-twitter'></i>  </a><a class="menu-item" href="https://www.youtube.com/playlist?list=PLqjVNzdDCzwZXR3lfqaFX_hZI3zB8nsVF" title="Podcast" rel="noopener noreffer" target="_blank"><i class='fa fa-podcast fa-fw' aria-hidden='true'></i>  </a><a class="menu-item" href="/disclaimer/" title="Disclaimer"><i class='fa-regular fa-file' aria-hidden='true'></i>  </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7670183691519835" crossorigin="anonymous"></script>
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="vCROCS"><span class="header-title-pre"><i class='far fa-house fa-solid'></i></span>vCROCS</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/about/" title="">About</a><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="/categories/" title="">Categories</a><a class="menu-item" href="/links/" title="Links"><i class='fab fa-bookmark fa-regular' aria-hidden='true'></i></a><a class="menu-item" href="/pics/" title="Pics"><i class='fab fa-image fa-regular' aria-hidden='true'></i></a><a class="menu-item" href="https://twitter.com/dalehassinger" title="Twitter" rel="noopener noreffer" target="_blank"><i class='fab fa-twitter'></i></a><a class="menu-item" href="https://www.youtube.com/playlist?list=PLqjVNzdDCzwZXR3lfqaFX_hZI3zB8nsVF" title="Podcast" rel="noopener noreffer" target="_blank"><i class='fa fa-podcast fa-fw' aria-hidden='true'></i></a><a class="menu-item" href="/disclaimer/" title="Disclaimer"><i class='fa-regular fa-file' aria-hidden='true'></i></a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">PowerCLI on Mac, Linux, and Windows</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="https://twitter.com/dalehassinger" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>Dale Hassinger</a></span>&nbsp;<span class="post-category">included in <a href="/categories/vcf-automation/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>VCF Automation</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2025-02-21">2025-02-21</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;2135 words&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;11 minutes&nbsp;</div>
        </div><div class="featured-image"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/powercli-loves-linux-mac-windows/featured-image.png"
        data-srcset="/powercli-loves-linux-mac-windows/featured-image.png, /powercli-loves-linux-mac-windows/featured-image.png 1.5x, /powercli-loves-linux-mac-windows/featured-image.png 2x"
        data-sizes="auto"
        alt="/powercli-loves-linux-mac-windows/featured-image.png"
        title="/powercli-loves-linux-mac-windows/featured-image.png" /></div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li>
          <ul>
            <li>
              <ul>
                <li>
                  <ul>
                    <li><a href="#lets-get-started">Let&rsquo;s get Started:</a></li>
                    <li><a href="#code-examples">Code Examples:</a></li>
                    <li><a href="#screenshots">Screenshots:</a></li>
                    <li><a href="#examples-of-cron-expressions">Examples of Cron Expressions</a></li>
                    <li><a href="#lessons-learned">Lessons learned:</a></li>
                  </ul>
                </li>
              </ul>
            </li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p><strong>Home Lab Automation!</strong></p>
<hr>
<blockquote>
<p>The real power of innovation comes not from the tools we use, but from the mindset we bring. Think outside the box, and any type of computer can become the key to endless possibilities.</p>
</blockquote>
<hr>
<h6 id="lets-get-started">Let&rsquo;s get Started:</h6>
<p><strong>Ready to dive into automation? Excellent choice!</strong></p>
<p><strong>Planning to automate on a Mac, Linux, or Windows? Fantastic!</strong></p>
<p>I love that <strong>VMware PowerCLI</strong> is built as a PowerShell module, making automation seamless across Mac, Linux, and Windows. Since VMware is my primary focus for automation, PowerShell is my go-to tool—thanks to PowerCLI. So far in my Automation journey, there hasn’t been a process I couldn’t automate with PowerShell.</p>
<hr>
<p>For 2025, I’ve been invited to be a <strong>VMware Community {code} Coach</strong>! This year, my blogs will feature even more code examples to help others get started with automation, VMware solutions, and much more&hellip;</p>
<hr>
<p>In my home lab, I needed a quick and easy way to power on and off my VMs. Some VMs I want to shut down every evening and start up again each morning—not just to save electricity, but also to give my MS-01s a bit of a break. In this blog, I’ll share the scripts I created to automate this process.</p>
<hr>
<p>I have a VCF environment running in my lab on a nested ESXi host, <small><a href="https://www.vcrocs.info/vcf-deploy-home-lab/" target="_blank" rel="noopener noreffer ">(See my Blog to create an VCF in your lab with a script)</a></small>. My goal is to log into the ESXi host, gracefully shut down all VCF VMs, then log into vCenter to shut down the nested ESXi host. To ensure a clean shutdown, I’ve added logic to verify that all VMs are powered off before proceeding to the next steps. In this blog, I’ll share the code I use to automate this process.</p>
<p>&ndash;</p>
<h6 id="code-examples">Code Examples:</h6>
<p>Script to Shutdown my VCF VMs:</p>
<p><small><span style="color: red; font-weight: bold;">Click arrow to expand the PowerShell code:</span></small></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-PowerShell" data-lang="PowerShell"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">###############################################</span>
</span></span><span class="line"><span class="cl"><span class="c"># PowerShell Script for Shutting Down VMs</span>
</span></span><span class="line"><span class="cl"><span class="c"># Author: Dale Hassinger</span>
</span></span><span class="line"><span class="cl"><span class="c"># Description: This script shuts down specific VMs on an ESXi host and vCenter.</span>
</span></span><span class="line"><span class="cl"><span class="c"># It also ensures proper logging and handles connections cleanly.</span>
</span></span><span class="line"><span class="cl"><span class="c">###############################################</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># ------------ Configuration Section ------------</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># ESXi connection parameters</span>
</span></span><span class="line"><span class="cl"><span class="nv">$ESXiHost</span> <span class="p">=</span> <span class="s2">&#34;192.168.4.179&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$ESXiUser</span> <span class="p">=</span> <span class="s2">&#34;root&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$ESXiPassword</span> <span class="p">=</span> <span class="s2">&#34;VMware1!&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># vCenter connection parameters</span>
</span></span><span class="line"><span class="cl"><span class="nv">$vCenterServer</span> <span class="p">=</span> <span class="s2">&#34;192.168.6.100&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$vCenterUser</span> <span class="p">=</span> <span class="s2">&#34;administrator@vcrocs.local&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$vCenterPassword</span> <span class="p">=</span> <span class="s2">&#34;VMware1!&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Log file location</span>
</span></span><span class="line"><span class="cl"><span class="nv">$logFile</span> <span class="p">=</span> <span class="s2">&#34;/home/administrator/power-off.log&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># VMs to shut down on ESXi</span>
</span></span><span class="line"><span class="cl"><span class="nv">$VMsToShutdown</span> <span class="p">=</span> <span class="vm">@</span><span class="p">(</span><span class="s2">&#34;vcf-m01-sddcm01&#34;</span><span class="p">,</span> <span class="s2">&#34;vcf-m01-vc01&#34;</span><span class="p">,</span> <span class="s2">&#34;vcf-m01-nsx01a&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># VM to shut down on vCenter (Nested ESXi)</span>
</span></span><span class="line"><span class="cl"><span class="nv">$VMToShutdown</span> <span class="p">=</span> <span class="s2">&#34;VCF-DDC-ESX179&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># ------------ Log Function ------------</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Function to write log messages with timestamps</span>
</span></span><span class="line"><span class="cl"><span class="kd">function</span><span class="w"> </span><span class="nb">Write-Log</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">param</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="p">[</span><span class="no">string</span><span class="p">]</span><span class="nv">$Message</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$LogDate</span> <span class="p">=</span> <span class="s2">&#34;[ &#34;</span> <span class="p">+</span> <span class="p">(</span><span class="nb">Get-Date</span><span class="p">).</span><span class="py">ToString</span><span class="p">(</span><span class="s2">&#34;MM-dd-yyyy HH:mm:ss&#34;</span><span class="p">)</span> <span class="p">+</span> <span class="s2">&#34; ] - &#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$Output</span> <span class="p">=</span> <span class="nv">$LogDate</span> <span class="p">+</span> <span class="nv">$Message</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Host</span> <span class="nv">$Output</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Add-Content</span> <span class="n">-Path</span> <span class="nv">$logFile</span> <span class="n">-Value</span> <span class="nv">$Output</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># ------------ Log File Setup ------------</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Remove existing log file if it exists</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nb">Test-Path</span> <span class="nv">$logFile</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Remove-Item</span> <span class="n">-Path</span> <span class="nv">$logFile</span> <span class="n">-Force</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Create a new empty log file</span>
</span></span><span class="line"><span class="cl"><span class="nb">New-Item</span> <span class="n">-Path</span> <span class="nv">$logFile</span> <span class="n">-ItemType</span> <span class="n">File</span> <span class="n">-Force</span> <span class="p">|</span> <span class="nb">Out-Null</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># ------------ Connect to vCenter ------------</span>
</span></span><span class="line"><span class="cl"><span class="nb">Write-Log</span> <span class="s2">&#34;Connecting to vCenter...&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$vCenterConnection</span> <span class="p">=</span> <span class="nb">Connect-VIServer</span> <span class="n">-Server</span> <span class="nv">$vCenterServer</span> <span class="n">-User</span> <span class="nv">$vCenterUser</span> <span class="n">-Password</span> <span class="nv">$vCenterPassword</span> <span class="n">-Force</span> <span class="n">-Protocol</span> <span class="n">https</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Check if the nested ESXi host is running</span>
</span></span><span class="line"><span class="cl"><span class="nb">Write-Log</span> <span class="s2">&#34;Checking if nested ESXi Host </span><span class="nv">$VMToShutdown</span><span class="s2"> is running...&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$vm</span> <span class="p">=</span> <span class="nb">Get-VM</span> <span class="n">-Name</span> <span class="nv">$VMToShutdown</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nv">$vm</span> <span class="o">-and</span> <span class="nv">$vm</span><span class="p">.</span><span class="py">PowerState</span> <span class="o">-eq</span> <span class="s2">&#34;PoweredOn&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Log</span> <span class="s2">&#34;Host is running. Connecting...&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$vCenterConnection</span> <span class="p">=</span> <span class="nb">Connect-VIServer</span> <span class="n">-Server</span> <span class="nv">$ESXiHost</span> <span class="n">-User</span> <span class="nv">$ESXiUser</span> <span class="n">-Password</span> <span class="nv">$ESXiPassword</span> <span class="n">-Force</span> <span class="n">-Protocol</span> <span class="n">https</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Log</span> <span class="s2">&#34;Connected to Host </span><span class="nv">$ESXiHost</span><span class="s2">.&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Log</span> <span class="s2">&#34;Host is not running. Exiting script.&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Disconnect-VIServer</span> <span class="n">-Server</span> <span class="p">*</span> <span class="n">-Confirm:</span><span class="vm">$false</span>
</span></span><span class="line"><span class="cl">    <span class="n">exit</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># ------------ Shutdown VMs on ESXi ------------</span>
</span></span><span class="line"><span class="cl"><span class="k">foreach</span> <span class="p">(</span><span class="nv">$vmName</span> <span class="k">in</span> <span class="nv">$VMsToShutdown</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$vm</span> <span class="p">=</span> <span class="nb">Get-VM</span> <span class="n">-Name</span> <span class="nv">$vmName</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nv">$vm</span> <span class="o">-and</span> <span class="nv">$vm</span><span class="p">.</span><span class="py">PowerState</span> <span class="o">-eq</span> <span class="s2">&#34;PoweredOn&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nb">Write-Log</span> <span class="s2">&#34;Shutting down VM: </span><span class="nv">$vmName</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$shutdownVM</span> <span class="p">=</span> <span class="nb">Shutdown-VMGuest</span> <span class="n">-VM</span> <span class="nv">$vm</span> <span class="n">-Confirm:</span><span class="vm">$false</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c"># Wait for VM to fully shut down</span>
</span></span><span class="line"><span class="cl">        <span class="nb">Write-Log</span> <span class="s2">&#34;Waiting for VM </span><span class="nv">$vmName</span><span class="s2"> to fully shut down...&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">do</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nb">Start-Sleep</span> <span class="n">-Seconds</span> <span class="mf">5</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$vm</span> <span class="p">=</span> <span class="nb">Get-VM</span> <span class="n">-Name</span> <span class="nv">$vmName</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="nv">$vm</span> <span class="o">-and</span> <span class="nv">$vm</span><span class="p">.</span><span class="py">PowerState</span> <span class="o">-ne</span> <span class="s2">&#34;PoweredOff&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">Write-Log</span> <span class="s2">&#34;VM </span><span class="nv">$vmName</span><span class="s2"> is now fully shut down.&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nb">Write-Log</span> <span class="s2">&#34;VM </span><span class="nv">$vmName</span><span class="s2"> is already powered off or not found.&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Disconnect from ESXi host</span>
</span></span><span class="line"><span class="cl"><span class="nb">Write-Log</span> <span class="s2">&#34;Disconnecting from ESXi host...&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">Disconnect-VIServer</span> <span class="n">-Server</span> <span class="nv">$ESXiHost</span> <span class="n">-Confirm:</span><span class="vm">$false</span>
</span></span><span class="line"><span class="cl"><span class="nb">Write-Log</span> <span class="s2">&#34;Disconnected from ESXi host.&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># ------------ Shutdown Nested Host on vCenter ------------</span>
</span></span><span class="line"><span class="cl"><span class="nb">Write-Log</span> <span class="s2">&#34;Shutting down VM: </span><span class="nv">$VMToShutdown</span><span class="s2"> on vCenter&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$vm</span> <span class="p">=</span> <span class="nb">Get-VM</span> <span class="n">-Name</span> <span class="nv">$VMToShutdown</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nv">$vm</span> <span class="o">-and</span> <span class="nv">$vm</span><span class="p">.</span><span class="py">PowerState</span> <span class="o">-eq</span> <span class="s2">&#34;PoweredOn&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$shutdownVM</span> <span class="p">=</span> <span class="nb">Shutdown-VMGuest</span> <span class="n">-VM</span> <span class="nv">$vm</span> <span class="n">-Confirm:</span><span class="vm">$false</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c"># Wait for VM to fully shut down</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Log</span> <span class="s2">&#34;Waiting for VM </span><span class="nv">$VMToShutdown</span><span class="s2"> to fully shut down...&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">do</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nb">Start-Sleep</span> <span class="n">-Seconds</span> <span class="mf">5</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$vm</span> <span class="p">=</span> <span class="nb">Get-VM</span> <span class="n">-Name</span> <span class="nv">$VMToShutdown</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="nv">$vm</span> <span class="o">-and</span> <span class="nv">$vm</span><span class="p">.</span><span class="py">PowerState</span> <span class="o">-ne</span> <span class="s2">&#34;PoweredOff&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Log</span> <span class="s2">&#34;VM </span><span class="nv">$VMToShutdown</span><span class="s2"> is now fully shut down.&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Log</span> <span class="s2">&#34;VM </span><span class="nv">$VMToShutdown</span><span class="s2"> is already powered off or not found.&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># ------------ Cleanup and Disconnect --------------------</span>
</span></span><span class="line"><span class="cl"><span class="nb">Write-Log</span> <span class="s2">&#34;Disconnecting from vCenter...&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">Disconnect-VIServer</span> <span class="n">-Server</span> <span class="p">*</span> <span class="n">-Confirm:</span><span class="vm">$false</span>
</span></span><span class="line"><span class="cl"><span class="nb">Write-Log</span> <span class="s2">&#34;Disconnected from vCenter.&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">Write-Log</span> <span class="s2">&#34;Script execution completed.&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><hr>
<p>Script to PowerOn my VCF VMs:</p>
<p><small><span style="color: red; font-weight: bold;">Click arrow to expand the PowerShell code:</span></small></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-PowerShell" data-lang="PowerShell"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">###############################################</span>
</span></span><span class="line"><span class="cl"><span class="c"># PowerShell Script for Powering On VMs</span>
</span></span><span class="line"><span class="cl"><span class="c"># Author: Dale Hassinger</span>
</span></span><span class="line"><span class="cl"><span class="c"># Description: This script starts specific VMs on an ESXi host and vCenter.</span>
</span></span><span class="line"><span class="cl"><span class="c"># It also ensures proper logging and handles connections cleanly.</span>
</span></span><span class="line"><span class="cl"><span class="c">###############################################</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># ------------ Configuration Section ------------</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># vCenter connection parameters</span>
</span></span><span class="line"><span class="cl"><span class="nv">$vCenterServer</span> <span class="p">=</span> <span class="s2">&#34;192.168.6.100&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$vCenterUser</span> <span class="p">=</span> <span class="s2">&#34;administrator@vcrocs.local&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$vCenterPassword</span> <span class="p">=</span> <span class="s2">&#34;VMware1!&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># ESXi connection parameters</span>
</span></span><span class="line"><span class="cl"><span class="nv">$ESXiHost</span> <span class="p">=</span> <span class="s2">&#34;192.168.4.179&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$ESXiUser</span> <span class="p">=</span> <span class="s2">&#34;root&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$ESXiPassword</span> <span class="p">=</span> <span class="s2">&#34;VMware1!&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Log file location</span>
</span></span><span class="line"><span class="cl"><span class="nv">$logFile</span> <span class="p">=</span> <span class="s2">&#34;/home/administrator/power-on.log&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># VMs to start on ESXi</span>
</span></span><span class="line"><span class="cl"><span class="nv">$VMsToStart</span> <span class="p">=</span> <span class="vm">@</span><span class="p">(</span><span class="s2">&#34;vcf-m01-sddcm01&#34;</span><span class="p">,</span> <span class="s2">&#34;vcf-m01-vc01&#34;</span><span class="p">,</span> <span class="s2">&#34;vcf-m01-nsx01a&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># VM to start on vCenter</span>
</span></span><span class="line"><span class="cl"><span class="nv">$VMToStart</span> <span class="p">=</span> <span class="s2">&#34;VCF-DDC-ESX179&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># ------------ Log Function ------------</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Function to write log messages with timestamps</span>
</span></span><span class="line"><span class="cl"><span class="kd">function</span><span class="w"> </span><span class="nb">Write-Log</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">param</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="p">[</span><span class="no">string</span><span class="p">]</span><span class="nv">$Message</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$LogDate</span> <span class="p">=</span> <span class="s2">&#34;[ &#34;</span> <span class="p">+</span> <span class="p">(</span><span class="nb">Get-Date</span><span class="p">).</span><span class="py">ToString</span><span class="p">(</span><span class="s2">&#34;MM-dd-yyyy HH:mm:ss&#34;</span><span class="p">)</span> <span class="p">+</span> <span class="s2">&#34; ] - &#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$Output</span> <span class="p">=</span> <span class="nv">$LogDate</span> <span class="p">+</span> <span class="nv">$Message</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Host</span> <span class="nv">$Output</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Add-Content</span> <span class="n">-Path</span> <span class="nv">$logFile</span> <span class="n">-Value</span> <span class="nv">$Output</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># ------------ Log File Setup ------------</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Remove existing log file if it exists</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nb">Test-Path</span> <span class="nv">$logFile</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Remove-Item</span> <span class="n">-Path</span> <span class="nv">$logFile</span> <span class="n">-Force</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Create a new empty log file</span>
</span></span><span class="line"><span class="cl"><span class="nb">New-Item</span> <span class="n">-Path</span> <span class="nv">$logFile</span> <span class="n">-ItemType</span> <span class="n">File</span> <span class="n">-Force</span> <span class="p">|</span> <span class="nb">Out-Null</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># ------------ Connect to vCenter ------------</span>
</span></span><span class="line"><span class="cl"><span class="nb">Write-Log</span> <span class="s2">&#34;Connecting to vCenter...&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$vcenterConnection</span> <span class="p">=</span> <span class="nb">Connect-VIServer</span> <span class="n">-Server</span> <span class="nv">$vCenterServer</span> <span class="n">-User</span> <span class="nv">$vCenterUser</span> <span class="n">-Password</span> <span class="nv">$vCenterPassword</span> <span class="n">-Force</span> <span class="n">-Protocol</span> <span class="n">https</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Check if VM is powered off before starting</span>
</span></span><span class="line"><span class="cl"><span class="nv">$vm</span> <span class="p">=</span> <span class="nb">Get-VM</span> <span class="n">-Name</span> <span class="nv">$VMToStart</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nv">$vm</span> <span class="o">-and</span> <span class="nv">$vm</span><span class="p">.</span><span class="py">PowerState</span> <span class="o">-ne</span> <span class="s2">&#34;PoweredOn&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Log</span> <span class="s2">&#34;Starting VM: </span><span class="nv">$VMToStart</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$startVM</span> <span class="p">=</span> <span class="nb">Start-VM</span> <span class="n">-VM</span> <span class="nv">$VMToStart</span> <span class="n">-Confirm:</span><span class="vm">$false</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c"># Wait for VM to be fully powered on</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Log</span> <span class="s2">&#34;Waiting for VM to fully power on...&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">do</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nb">Start-Sleep</span> <span class="n">-Seconds</span> <span class="mf">5</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$vm</span> <span class="p">=</span> <span class="nb">Get-VM</span> <span class="n">-Name</span> <span class="nv">$VMToStart</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="nv">$vm</span> <span class="o">-and</span> <span class="nv">$vm</span><span class="p">.</span><span class="py">PowerState</span> <span class="o">-ne</span> <span class="s2">&#34;PoweredOn&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Log</span> <span class="s2">&#34;VM </span><span class="nv">$VMToStart</span><span class="s2"> is now fully powered on.&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Log</span> <span class="s2">&#34;VM </span><span class="nv">$VMToStart</span><span class="s2"> is already powered on or not found.&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Disconnect from vCenter</span>
</span></span><span class="line"><span class="cl"><span class="nb">Write-Log</span> <span class="s2">&#34;Disconnecting from vCenter...&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">Disconnect-VIServer</span> <span class="n">-Server</span> <span class="p">*</span> <span class="n">-Confirm:</span><span class="vm">$false</span>
</span></span><span class="line"><span class="cl"><span class="nb">Write-Log</span> <span class="s2">&#34;Disconnected from vCenter.&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Wait for Nested ESXi host to start</span>
</span></span><span class="line"><span class="cl"><span class="nb">Write-Log</span> <span class="s2">&#34;Waiting 2 minutes for Nested host to start...&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">Start-Sleep</span> <span class="n">-Seconds</span> <span class="mf">120</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># ------------ Connect to ESXi Host ------------</span>
</span></span><span class="line"><span class="cl"><span class="nb">Write-Log</span> <span class="s2">&#34;Connecting to ESXi host </span><span class="nv">$ESXiHost</span><span class="s2">...&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$vcenterConnection</span> <span class="p">=</span> <span class="nb">Connect-VIServer</span> <span class="n">-Server</span> <span class="nv">$ESXiHost</span> <span class="n">-User</span> <span class="nv">$ESXiUser</span> <span class="n">-Password</span> <span class="nv">$ESXiPassword</span> <span class="n">-Force</span> <span class="n">-Protocol</span> <span class="n">https</span>
</span></span><span class="line"><span class="cl"><span class="nb">Write-Log</span> <span class="s2">&#34;Connected to ESXi host </span><span class="nv">$ESXiHost</span><span class="s2">.&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Start the VMs one at a time and wait until each is running before proceeding</span>
</span></span><span class="line"><span class="cl"><span class="k">foreach</span> <span class="p">(</span><span class="nv">$vmName</span> <span class="k">in</span> <span class="nv">$VMsToStart</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$vm</span> <span class="p">=</span> <span class="nb">Get-VM</span> <span class="n">-Name</span> <span class="nv">$vmName</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nv">$vm</span> <span class="o">-and</span> <span class="nv">$vm</span><span class="p">.</span><span class="py">PowerState</span> <span class="o">-ne</span> <span class="s2">&#34;PoweredOn&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nb">Write-Log</span> <span class="s2">&#34;Starting VM: </span><span class="nv">$vmName</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$startVM</span> <span class="p">=</span> <span class="nb">Start-VM</span> <span class="n">-VM</span> <span class="nv">$vmName</span> <span class="n">-Confirm:</span><span class="vm">$false</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c"># Wait for VM to be fully powered on</span>
</span></span><span class="line"><span class="cl">        <span class="nb">Write-Log</span> <span class="s2">&#34;Waiting for VM </span><span class="nv">$vmName</span><span class="s2"> to fully power on...&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">do</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nb">Start-Sleep</span> <span class="n">-Seconds</span> <span class="mf">5</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$vm</span> <span class="p">=</span> <span class="nb">Get-VM</span> <span class="n">-Name</span> <span class="nv">$vmName</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="nv">$vm</span> <span class="o">-and</span> <span class="nv">$vm</span><span class="p">.</span><span class="py">PowerState</span> <span class="o">-ne</span> <span class="s2">&#34;PoweredOn&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">Write-Log</span> <span class="s2">&#34;VM </span><span class="nv">$vmName</span><span class="s2"> is now fully powered on.&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nb">Write-Log</span> <span class="s2">&#34;VM </span><span class="nv">$vmName</span><span class="s2"> is already powered on or not found.&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># ------------ Cleanup and Disconnect ------------</span>
</span></span><span class="line"><span class="cl"><span class="nb">Write-Log</span> <span class="s2">&#34;Disconnecting from ESXi host...&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">Disconnect-VIServer</span> <span class="n">-Server</span> <span class="nv">$ESXiHost</span> <span class="n">-Confirm:</span><span class="vm">$false</span>
</span></span><span class="line"><span class="cl"><span class="nb">Write-Log</span> <span class="s2">&#34;Disconnected from ESXi host.&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">Write-Log</span> <span class="s2">&#34;Script execution completed.&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><hr>
<h6 id="screenshots">Screenshots:</h6>
<p><small>A screenshot of the nested ESXi host within vCenter to illustrate what the script will power on and off:</small></p>
<figure><a class="lightgallery" href="/powercli-loves-linux-mac-windows/vcf-lab-01.png" title="/powercli-loves-linux-mac-windows/vcf-lab-01.png" data-thumbnail="/powercli-loves-linux-mac-windows/vcf-lab-01.png" data-sub-html="<h2>Click to see Larger Image of Screen Shot</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/powercli-loves-linux-mac-windows/vcf-lab-01.png"
            data-srcset="/powercli-loves-linux-mac-windows/vcf-lab-01.png, /powercli-loves-linux-mac-windows/vcf-lab-01.png 1.5x, /powercli-loves-linux-mac-windows/vcf-lab-01.png 2x"
            data-sizes="auto"
            alt="/powercli-loves-linux-mac-windows/vcf-lab-01.png" width="3408" height="1856" />
    </a><figcaption class="image-caption">Click to see Larger Image of Screen Shot</figcaption>
    </figure>
<hr>
<p><small>A screenshot of the nested ESXi host VCF VMs to illustrate what the script will power on and off:</small></p>
<figure><a class="lightgallery" href="/powercli-loves-linux-mac-windows/vcf-lab-02.png" title="/powercli-loves-linux-mac-windows/vcf-lab-02.png" data-thumbnail="/powercli-loves-linux-mac-windows/vcf-lab-02.png" data-sub-html="<h2>Click to see Larger Image of Screen Shot</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/powercli-loves-linux-mac-windows/vcf-lab-02.png"
            data-srcset="/powercli-loves-linux-mac-windows/vcf-lab-02.png, /powercli-loves-linux-mac-windows/vcf-lab-02.png 1.5x, /powercli-loves-linux-mac-windows/vcf-lab-02.png 2x"
            data-sizes="auto"
            alt="/powercli-loves-linux-mac-windows/vcf-lab-02.png" width="3404" height="1696" />
    </a><figcaption class="image-caption">Click to see Larger Image of Screen Shot</figcaption>
    </figure>
<hr>
<p>To automate tasks in my lab, I use a <strong>Rocky Linux</strong> VM with <strong>PowerShell</strong> installed. I’ve set up cron jobs to execute my PowerShell scripts on a schedule. Here are some details on how I configured these cron jobs to streamline automation.</p>
<p>A great resource for setting up cron jobs properly? <strong>ChatGPT!</strong> It’s a handy tool for troubleshooting and getting the syntax just right.</p>
<p>Proper format to run PowerShell Scripts with a cron job.</p>
<p><small><span style="color: red; font-weight: bold;">Click arrow to expand the cron job code:</span></small></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Bash" data-lang="Bash"><span class="line"><span class="cl"><span class="c1"># Power On VCF Lab @ 5:00 am everyday</span>
</span></span><span class="line"><span class="cl"><span class="m">0</span> <span class="m">5</span> * * * /usr/bin/pwsh /home/administrator/power-on.ps1 &gt;&gt; /home/administrator/power-on.log 2&gt;<span class="p">&amp;</span><span class="m">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Power Off VCF Lab @ 11:59 pm everyday</span>
</span></span><span class="line"><span class="cl"><span class="m">59</span> <span class="m">11</span> * * * /usr/bin/pwsh /home/administrator/power-off.ps1 &gt;&gt; /home/administrator/power-off.log 2&gt;<span class="p">&amp;</span><span class="m">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># cron format for day/time</span>
</span></span><span class="line"><span class="cl">* * * * * command_to_run
</span></span><span class="line"><span class="cl">│ │ │ │ │
</span></span><span class="line"><span class="cl">│ │ │ │ └── Day of the week <span class="o">(</span>0-7, <span class="nv">Sunday</span> <span class="o">=</span> <span class="m">0</span> or 7<span class="o">)</span>
</span></span><span class="line"><span class="cl">│ │ │ └──── Month <span class="o">(</span>1-12<span class="o">)</span>
</span></span><span class="line"><span class="cl">│ │ └────── Day of the month <span class="o">(</span>1-31<span class="o">)</span>
</span></span><span class="line"><span class="cl">│ └──────── Hour <span class="o">(</span>0-23<span class="o">)</span>
</span></span><span class="line"><span class="cl">└────────── Minute <span class="o">(</span>0-59<span class="o">)</span>
</span></span><span class="line"><span class="cl">  
</span></span></code></pre></td></tr></table>
</div>
</div><p><small><span style="color: red; font-weight: bold;">Click arrow to expand the cron commands:</span></small></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Bash" data-lang="Bash"><span class="line"><span class="cl"><span class="c1"># edit cron jobs</span>
</span></span><span class="line"><span class="cl">crontab -e
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># List cron jobs</span>
</span></span><span class="line"><span class="cl">crontab -l
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># restart cron service</span>
</span></span><span class="line"><span class="cl">sudo systemctl restart crond
</span></span><span class="line"><span class="cl">  
</span></span></code></pre></td></tr></table>
</div>
</div><h6 id="examples-of-cron-expressions">Examples of Cron Expressions</h6>
<table>
  <thead>
      <tr>
          <th>Cron Expression</th>
          <th>Meaning</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>0 0 * * *</code></td>
          <td>Runs at midnight every day</td>
      </tr>
      <tr>
          <td><code>0 12 * * 1-5</code></td>
          <td>Runs at noon (12:00 PM) Monday to Friday</td>
      </tr>
      <tr>
          <td><code>*/15 * * * *</code></td>
          <td>Runs every 15 minutes</td>
      </tr>
      <tr>
          <td><code>30 9 1 * *</code></td>
          <td>Runs at 9:30 AM on the 1st day of every month</td>
      </tr>
      <tr>
          <td><code>0 18 * * 5</code></td>
          <td>Runs at 6:00 PM every Friday</td>
      </tr>
      <tr>
          <td><code>0 3 * * 1,3,5</code></td>
          <td>Runs at 3:00 AM on Monday, Wednesday, and Friday</td>
      </tr>
  </tbody>
</table>
<hr>
<h6 id="lessons-learned">Lessons learned:</h6>
<ul>
<li>Automating VM power on and off helps ensure consistency in your workflows.</li>
<li>All the scripts in this blog were created and tested on a Mac using PowerShell.</li>
<li>In the lab, the scripts are scheduled and executed on a Rocky Linux VM with PowerShell installed.</li>
<li>Don’t dismiss PowerShell just because it was created by Microsoft. Embrace it to enhance your automation journey!</li>
</ul>
<hr>
<div class="details admonition tip open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-lightbulb fa-fw" aria-hidden="true"></i>vCROCS Deep Dive Podcast<i class="details-icon fas fa-angle-right fa-fw" aria-hidden="true"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><p>I created a Google NotebookLM Podcast based on the content of this blog. While it may not be entirely accurate, is any podcast ever 100% perfect, even when real people are speaking? Take a moment to listen and share your thoughts with me!</p>
<p><a href="https://youtu.be/8jPQHbtK1s8" target="_blank" rel="noopener noreffer ">vCROCS Deep Dive Podcast | VCF Automation | Input Arrays</a></p>
</div>
        </div>
    </div>
<hr>
<div class="details admonition info open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-info-circle fa-fw" aria-hidden="true"></i>Info<i class="details-icon fas fa-angle-right fa-fw" aria-hidden="true"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content">In my blogs, I often emphasize that there are multiple methods to achieve the same objective. This article presents just one of the many ways you can tackle this task. I&rsquo;ve shared what I believe to be an effective approach for this particular use case, but keep in mind that every organization and environment varies. There&rsquo;s no definitive right or wrong way to accomplish the tasks discussed in this article.</div>
        </div>
    </div>
<hr>
<div class="details admonition warning open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-exclamation-triangle fa-fw" aria-hidden="true"></i>Lab<i class="details-icon fas fa-angle-right fa-fw" aria-hidden="true"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content">Always test new setups and processes, like those discussed in this blog, in a lab environment before implementing them in a production environment.</div>
        </div>
    </div>
<hr>
<div class="details admonition tip open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-lightbulb fa-fw" aria-hidden="true"></i>Tips and Tricks<i class="details-icon fas fa-angle-right fa-fw" aria-hidden="true"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content">If you found this blog article helpful and it assisted you, consider buying me a coffee to kickstart my day.</div>
        </div>
    </div>
<center>
<script type="text/javascript" src="https://cdnjs.buymeacoffee.com/1.0.0/button.prod.min.js" data-name="bmc-button" data-slug="dalehassinger" data-color="#FFDD00" data-emoji=""  data-font="Cookie" data-text="Buy me a coffee" data-outline-color="#000000" data-font-color="#000000" data-coffee-color="#ffffff" ></script>
</center>
<hr>
<div style="font-weight: bold;">Comments:</div>
<div style="height: 20px;"></div>
<div
  id="cusdis_thread"
  data-host="https://cusdis.com"
  data-app-id="c49f7fae-719b-4753-a518-a57e5321d7c1"
  data-page-id="posts/powercli-loves-linux-mac-windows/index.en.md"
  data-page-url="https://www.vcrocs.info/powercli-loves-linux-mac-windows/"
  data-page-title="PowerCLI on Mac, Linux, and Windows"
></div>
<script async defer src="https://cusdis.com/js/cusdis.es.js"></script></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2025-02-21</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="https://www.vcrocs.info/powercli-loves-linux-mac-windows/" data-title="PowerCLI on Mac, Linux, and Windows" data-via="dalehassinger" data-hashtags="VCF,Automation,PowerShell,PowerCLI,VMware Code Coach,VMware vExpert"><i class="fab fa-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="https://www.vcrocs.info/powercli-loves-linux-mac-windows/" data-hashtag="VCF"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Linkedin" data-sharer="linkedin" data-url="https://www.vcrocs.info/powercli-loves-linux-mac-windows/"><i class="fab fa-linkedin fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/vcf/">VCF</a>,&nbsp;<a href="/tags/automation/">Automation</a>,&nbsp;<a href="/tags/powershell/">PowerShell</a>,&nbsp;<a href="/tags/powercli/">PowerCLI</a>,&nbsp;<a href="/tags/vmware-code-coach/">VMware Code Coach</a>,&nbsp;<a href="/tags/vmware-vexpert/">VMware VExpert</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/vcf-automation-input-array/" class="prev" rel="prev" title="VCF Automation | Input Arrays"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>VCF Automation | Input Arrays</a></div>
</div>
<div id="comments"></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Designed | Developed By vCROCS</div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2019 - 2025</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://www.vcrocs.info" target="_blank">Dale Hassinger</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://www.vCROCS.info" target="_blank">www.vCROCS.info</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/css/lightgallery-bundle.min.css"><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/lightgallery.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/thumbnail/lg-thumbnail.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/zoom/lg-zoom.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":50},"comment":{},"lightgallery":true,"search":{"highlightTag":"em","lunrIndexURL":"/index.json","maxResultLength":10,"noResultsFound":"No results found","snippetLength":30,"type":"lunr"}};</script><script type="text/javascript" src="/js/theme.min.js"></script><script type="text/javascript">
            window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());
            gtag('config', 'G-KSLC6FHF36');
        </script><script type="text/javascript" src="https://www.googletagmanager.com/gtag/js?id=G-KSLC6FHF36" async></script></body>
</html>
