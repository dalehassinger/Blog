<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>VCF Deploy | Scripted Install | Home Lab - vCROCS</title><meta name="Description" content="Enterprise Automation, Monitoring and Logging. Plus more..."><meta property="og:url" content="https://www.vcrocs.info/vcf-deploy-home-lab/">
  <meta property="og:site_name" content="vCROCS">
  <meta property="og:title" content="VCF Deploy | Scripted Install | Home Lab">
  <meta property="og:description" content="How to script a VCF SDDC Manager install on a single Nested ESXi Host!">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-12-26T00:00:00+00:00">
    <meta property="article:modified_time" content="2024-12-26T00:00:00+00:00">
    <meta property="article:tag" content="VCF">
    <meta property="article:tag" content="Automation">
    <meta property="article:tag" content="Operations">
    <meta property="article:tag" content="PowerShell">
    <meta property="og:image" content="https://www.vcrocs.info/vcf-deploy-home-lab/featured-image.png">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://www.vcrocs.info/vcf-deploy-home-lab/featured-image.png">
  <meta name="twitter:title" content="VCF Deploy | Scripted Install | Home Lab">
  <meta name="twitter:description" content="How to script a VCF SDDC Manager install on a single Nested ESXi Host!">
      <meta name="twitter:site" content="@dalehassinger">
<meta name="application-name" content="vCROCS">
<meta name="apple-mobile-web-app-title" content="vCROCS"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="canonical" href="https://www.vcrocs.info/vcf-deploy-home-lab/" /><link rel="prev" href="https://www.vcrocs.info/2024-top-blogs-and-stats/" /><link rel="next" href="https://www.vcrocs.info/vcf-automation-input-array/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css"></noscript><link rel="preload" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "VCF Deploy | Scripted Install | Home Lab",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/www.vcrocs.info\/vcf-deploy-home-lab\/"
        },"image": [{
                            "@type": "ImageObject",
                            "url": "https:\/\/www.vcrocs.info\/vcf-deploy-home-lab\/featured-image.png",
                            "width":  1420 ,
                            "height":  708 
                        }],"genre": "posts","keywords": "VCF, Automation, Operations, PowerShell","wordcount":  6129 ,
        "url": "https:\/\/www.vcrocs.info\/vcf-deploy-home-lab\/","datePublished": "2024-12-26T00:00:00+00:00","dateModified": "2024-12-26T00:00:00+00:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
            "@type": "Organization",
            "name": "xxxx","logo": {
                    "@type": "ImageObject",
                    "url": "https:\/\/www.vcrocs.info\/images\/avatar.png",
                    "width":  528 ,
                    "height":  560 
                }},"author": {
                "@type": "Person",
                "name": "Dale Hassinger"
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7670183691519835" crossorigin="anonymous"></script>
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="vCROCS"><span class="header-title-pre"><i class='far fa-house fa-solid'></i></span>vCROCS</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/about/"> About </a><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="/categories/"> Categories </a><a class="menu-item" href="/links/" title="Links"><i class='fab fa-bookmark fa-regular' aria-hidden='true'></i>  </a><a class="menu-item" href="/pics/" title="Pics"><i class='fab fa-image fa-regular' aria-hidden='true'></i>  </a><a class="menu-item" href="https://twitter.com/dalehassinger" title="Twitter" rel="noopener noreffer" target="_blank"><i class='fab fa-twitter'></i>  </a><a class="menu-item" href="https://www.youtube.com/playlist?list=PLqjVNzdDCzwZXR3lfqaFX_hZI3zB8nsVF" title="Podcast" rel="noopener noreffer" target="_blank"><i class='fa fa-podcast fa-fw' aria-hidden='true'></i>  </a><a class="menu-item" href="/disclaimer/" title="Disclaimer"><i class='fa-regular fa-file' aria-hidden='true'></i>  </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7670183691519835" crossorigin="anonymous"></script>
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="vCROCS"><span class="header-title-pre"><i class='far fa-house fa-solid'></i></span>vCROCS</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/about/" title="">About</a><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="/categories/" title="">Categories</a><a class="menu-item" href="/links/" title="Links"><i class='fab fa-bookmark fa-regular' aria-hidden='true'></i></a><a class="menu-item" href="/pics/" title="Pics"><i class='fab fa-image fa-regular' aria-hidden='true'></i></a><a class="menu-item" href="https://twitter.com/dalehassinger" title="Twitter" rel="noopener noreffer" target="_blank"><i class='fab fa-twitter'></i></a><a class="menu-item" href="https://www.youtube.com/playlist?list=PLqjVNzdDCzwZXR3lfqaFX_hZI3zB8nsVF" title="Podcast" rel="noopener noreffer" target="_blank"><i class='fa fa-podcast fa-fw' aria-hidden='true'></i></a><a class="menu-item" href="/disclaimer/" title="Disclaimer"><i class='fa-regular fa-file' aria-hidden='true'></i></a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">VCF Deploy | Scripted Install | Home Lab</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="https://twitter.com/dalehassinger" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>Dale Hassinger</a></span>&nbsp;<span class="post-category">included in <a href="/categories/vcf-sddc-manager/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>VCF SDDC Manager</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2024-12-26">2024-12-26</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;6129 words&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;29 minutes&nbsp;</div>
        </div><div class="featured-image"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/vcf-deploy-home-lab/featured-image.png"
        data-srcset="/vcf-deploy-home-lab/featured-image.png, /vcf-deploy-home-lab/featured-image.png 1.5x, /vcf-deploy-home-lab/featured-image.png 2x"
        data-sizes="auto"
        alt="/vcf-deploy-home-lab/featured-image.png"
        title="/vcf-deploy-home-lab/featured-image.png" /></div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li>
          <ul>
            <li><a href="#use-case-for-creating-this-blog">Use Case for Creating this Blog</a>
              <ul>
                <li><a href="#goals">Goals:</a></li>
                <li><a href="#initial-considerations">Initial Considerations:</a></li>
                <li><a href="#inspiration-and-approach">Inspiration and Approach:</a></li>
                <li><a href="#outcome">Outcome:</a></li>
                <li><a href="#home-lab-hardware">Home Lab Hardware</a></li>
                <li><a href="#powershell-scripts">PowerShell Scripts:</a></li>
                <li><a href="#screen-shots">Screen Shots:</a></li>
                <li><a href="#lessons-learned">Lessons Learned:</a></li>
              </ul>
            </li>
            <li><a href="#downloading-the-nested-esxi-virtual-appliances-from-vmware-fling-site">Downloading the Nested ESXi Virtual Appliances from VMware Fling Site</a>
              <ul>
                <li><a href="#important-note-for-macos-users">Important Note for macOS Users</a></li>
              </ul>
            </li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p><strong>How to script a VCF SDDC Manager install on a single Nested ESXi Host!</strong></p>
<hr>
<blockquote>
<p>You have to work hard to get your thinking clean to make it simple. But it&rsquo;s worth it in the end because once you get there, you can move mountains. - Steve Jobs</p></blockquote>
<hr>
<p>Product Versions used for this Blog:</p>
<ul>
<li>VMware Cloud Foundation: 5.2.1</li>
<li>PowerCLI: 13.3</li>
<li>PowerShell: 7.4.6</li>
</ul>
<hr>
<h4 id="use-case-for-creating-this-blog">Use Case for Creating this Blog</h4>
<h5 id="goals">Goals:</h5>
<ul>
<li>Leverage my existing Home Lab Hardware to start using and learning about VMware Cloud Foundation (VCF).</li>
<li>Enable quick creation or re-creation of a VCF environment.</li>
<li>Run VCF on a single Minisforum MS-01 using nested ESXi.
<ul>
<li>For this use case, a vCenter is already set up and running with multiple physical ESXi hosts.</li>
</ul>
</li>
<li>Utilize Tiered Memory with the MS-01 to support more VMs and explore how Tiered Memory works.</li>
<li>Run the Cloud Builder steps manually to gain hands-on experience, using a JSON file generated by the script for deployment.</li>
<li>Install VCF 5.2.1 with the script, then manually upgrade to VCF 5.2.1.1 to learn how SDDC Manager performs upgrades.</li>
<li>Manually create Workload Domains to better understand the deployment process and deepen learning.</li>
<li>Add the line <code>bringup.mgmt.cluster.minimum.size=1</code> to the file <code>/etc/vmware/vcf/bringup/application.properties</code> to enable VCF SDDC Manager to run on a single nested ESXi host.</li>
<li>Ensure performance is sufficient for learning purposes, without requiring production-level speed.</li>
</ul>
<h5 id="initial-considerations">Initial Considerations:</h5>
<p>I explored VMware Holodeck as an option, but the resource requirements were too high for my setup.</p>
<h5 id="inspiration-and-approach">Inspiration and Approach:</h5>
<p>I came across William Lam&rsquo;s Blog about running VCF on a single NUC and decided to adapt that idea for my lab. William also provides a PowerShell script that automates the entire VCF installation in a single run. William&rsquo;s script does require more than one ESXi Host.</p>
<h5 id="outcome">Outcome:</h5>
<p>After evaluating the available options, I decided to modify some of the example PowerShell scripts and processes to deploy and manage VCF in my Home Lab.</p>
<p>This blog serves as a guide to automate VMware Cloud Foundation (VCF) deployment in a home lab environment. It is also designed as a learning resource for VCF, which is why some steps are performed manually.</p>
<p>By combining automation with hands-on tasks, the goal is to help you understand VCF deployment processes while enabling you to streamline repetitive tasks for future setups.</p>
<p>Whether you&rsquo;re exploring VCF for the first time or looking to optimize your home lab, this approach provides flexibility to learn, experiment, and refine your deployment strategies.</p>
<p><strong>This blog post shares the scripts and the steps I followed to make it all work.</strong></p>
<hr>
<h5 id="home-lab-hardware">Home Lab Hardware</h5>
<p><strong>Primary Systems:</strong></p>
<ul>
<li>(2) Minisforum MS-01
<ul>
<li>96 GB memory</li>
<li>Intel Core i9-13900H (14 cores: 6 Performance + 8 Efficient)
<ul>
<li>I use all cores and specify which cores to use per VM with <code>Scheduling Affinity</code> rules.</li>
<li>VMs like VCF Automation and Operations, I use the performance cores.</li>
<li>VMs with light use, I specify the Efficient Cores.</li>
</ul>
</li>
<li>Storage Configuration:
<ul>
<li>1 TB NVMe for Tiered Memory @ 400% (SAMSUNG 990 PRO SSD NVMe)
<ul>
<li>To specify the amount of tiered memory you want to use, you need to set a percentage. This percentage determines how much tiered memory is allocated relative to the physical memory. For example, in my lab, I have 96 GB of physical memory.</li>
<li>Using a 400% tiered memory configuration:<br>
￼     - (96 GB * 400%) + 96 GB physical = 480 GB Total Memory.</li>
</ul>
</li>
<li>4 TB NVMe for Storage (SAMSUNG 990 PRO SSD NVMe)</li>
<li>1 NVMe slot open for future expansion</li>
</ul>
</li>
<li>(1) MS-01 runs everything in my lab but the VCF environment</li>
<li>(1) MS-01 is dedicated for this VCF environment. All VMs that it takes for a VCF environment</li>
</ul>
</li>
</ul>
<p><strong>Additional Systems:</strong></p>
<ul>
<li>(2) Apple Mac Minis (Intel-based)
<ul>
<li>Running Fusion and Nested ESXi</li>
<li>64 GB memory each</li>
<li>Processors:
<ul>
<li>1 with Intel i3</li>
<li>1 with Intel i5</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<p><strong>Thoughts on the Minisforum MS-01:</strong></p>
<ul>
<li>I’m extremely satisfied with the Minisforum MS-01. If I expand my lab, I plan to add more MS-01 units.</li>
<li>The MS-01 includes (2) SFP ports, and I’m considering adding 10 GbE networking to support future lab improvements.</li>
<li>The MS-01 CPU fan will run continuously due to the high number of VMs running.</li>
</ul>
<hr>
<h5 id="powershell-scripts">PowerShell Scripts:</h5>
<p><strong>Script Overview - Step 1</strong></p>
<p><strong>Purpose:</strong>
This script automates the creation of the Nested ESXi Host required by VCF Cloud Builder to deploy and configure the VCF environment.</p>
<p><strong>Steps Performed:</strong></p>
<ul>
<li>Create the Nested ESXi Host – Prepares the environment for VCF Cloud Builder to handle the installation and deployment process.</li>
<li>This script is designed to install nested ESXi hosts and can be reused for various use cases.
<ul>
<li>By keeping this step as a separate script, it allows flexibility for future deployments beyond this specific lab setup.</li>
<li>Update this script with names and IP addresses that match your lab environment.</li>
</ul>
</li>
</ul>
<hr>
<p><small><span style="color: red; font-weight: bold;">Click arrow to expand the PowerShell code:</span></small></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-PowerShell" data-lang="PowerShell"><span class="line"><span class="cl"><span class="c"># Script to add Nested ESXi Host</span>
</span></span><span class="line"><span class="cl"><span class="c"># Author: Dale Hassinger</span>
</span></span><span class="line"><span class="cl"><span class="c"># Based on Script by: William Lam and other vCommunity Web Sites</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># vCenter Server used to deploy VMware Cloud Foundation Lab</span>
</span></span><span class="line"><span class="cl"><span class="nv">$VIServer</span>   <span class="p">=</span> <span class="s2">&#34;192.168.6.100&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$VIUsername</span> <span class="p">=</span> <span class="s2">&#34;administrator@vcrocs.local&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$VIPassword</span> <span class="p">=</span> <span class="s2">&#34;VMware1!&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Full Path to the Nested ESXi</span>
</span></span><span class="line"><span class="cl"><span class="nv">$NestedESXiApplianceOVA</span> <span class="p">=</span> <span class="s2">&#34;/Users/dalehassinger/Downloads/Nested_ESXi8.0u3c_Appliance_Template_v1.ova&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Nested ESXi VMs for Management Domain</span>
</span></span><span class="line"><span class="cl"><span class="nv">$NestedESXiHostnameToIPsForManagementDomain</span> <span class="p">=</span> <span class="vm">@</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;VCF-DDC-ESX179&#34;</span>   <span class="p">=</span> <span class="s2">&#34;192.168.4.179&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="c"># End Nested Names</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Nested ESXi VM Resources for Management Domain</span>
</span></span><span class="line"><span class="cl"><span class="nv">$NestedESXiMGMTvCPU</span>          <span class="p">=</span> <span class="s2">&#34;12&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$NestedESXiMGMTvMEM</span>          <span class="p">=</span> <span class="s2">&#34;88&#34;</span> <span class="c">#GB</span>
</span></span><span class="line"><span class="cl"><span class="nv">$NestedESXiMGMTCachingvDisk</span>  <span class="p">=</span> <span class="s2">&#34;4&#34;</span> <span class="c">#GB</span>
</span></span><span class="line"><span class="cl"><span class="nv">$NestedESXiMGMTCapacityvDisk</span> <span class="p">=</span> <span class="s2">&#34;500&#34;</span> <span class="c">#GB</span>
</span></span><span class="line"><span class="cl"><span class="nv">$NestedESXiMGMTBootDisk</span>      <span class="p">=</span> <span class="s2">&#34;32&#34;</span> <span class="c">#GB</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># General Deployment Configuration for Nested ESXi</span>
</span></span><span class="line"><span class="cl"><span class="c"># These Values are for existing existing vCenter Install</span>
</span></span><span class="line"><span class="cl"><span class="c">#$VMDatacenter = &#34;Datacenter-DB-01&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$VMCluster</span>    <span class="p">=</span> <span class="s2">&#34;VCF_LAB&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$VMNetwork</span>    <span class="p">=</span> <span class="s2">&#34;VMs&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$VMDatastore</span>  <span class="p">=</span> <span class="s2">&#34;ESX-04-2TB&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$VMNetmask</span>    <span class="p">=</span> <span class="s2">&#34;255.255.252.0&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$VMGateway</span>    <span class="p">=</span> <span class="s2">&#34;192.168.4.1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$VMDNS</span>        <span class="p">=</span> <span class="s2">&#34;192.168.6.1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$VMNTP</span>        <span class="p">=</span> <span class="s2">&#34;time.google.com&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$VMPassword</span>   <span class="p">=</span> <span class="s2">&#34;VMware1!&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$VMDomain</span>     <span class="p">=</span> <span class="s2">&#34;vcrocs.local&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$VMSyslog</span>     <span class="p">=</span> <span class="s2">&#34;192.168.6.94&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c">#$VMFolder     = &#34;VCF-VMs&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">#### DO NOT EDIT BEYOND HERE ####</span>
</span></span><span class="line"><span class="cl"><span class="c"># 1 = yes</span>
</span></span><span class="line"><span class="cl"><span class="c"># 0 - no</span>
</span></span><span class="line"><span class="cl"><span class="nv">$confirmDeployment</span> <span class="p">=</span> <span class="mf">1</span>
</span></span><span class="line"><span class="cl"><span class="nv">$deployNestedESXiVMsForMgmt</span> <span class="p">=</span> <span class="mf">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$StartTimeLogFile</span> <span class="p">=</span> <span class="nb">Get-Date</span> <span class="n">-Format</span> <span class="s2">&#34;yyyyMMddHHmm&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c">#$StartTimeLogFile</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$verboseLogFile</span> <span class="p">=</span> <span class="s2">&#34;vcf-lab-deployment-</span><span class="nv">$StartTimeLogFile</span><span class="s2">.log&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c">#$verboseLogFile</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$StartTime</span> <span class="p">=</span> <span class="nb">Get-Date</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">Function</span><span class="w"> </span><span class="nb">New-LogEvent</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">param</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">[</span><span class="nb">Parameter</span><span class="p">(</span><span class="na">Mandatory</span><span class="p">=</span><span class="vm">$true</span><span class="p">)][</span><span class="no">String</span><span class="p">]</span><span class="nv">$message</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">[</span><span class="nb">Parameter</span><span class="p">(</span><span class="na">Mandatory</span><span class="p">=</span><span class="vm">$false</span><span class="p">)][</span><span class="no">String</span><span class="p">]</span><span class="nv">$color</span><span class="p">=</span><span class="s2">&#34;green&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">$timeStamp</span> <span class="p">=</span> <span class="nb">Get-Date</span> <span class="n">-Format</span> <span class="s2">&#34;MM-dd-yyyy_hh:mm:ss&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Host</span> <span class="n">-NoNewline</span> <span class="n">-ForegroundColor</span> <span class="n">White</span> <span class="s2">&#34;[</span><span class="nv">$timestamp</span><span class="s2">]&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Host</span> <span class="n">-ForegroundColor</span> <span class="nv">$color</span> <span class="s2">&#34; </span><span class="nv">$message</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$logMessage</span> <span class="p">=</span> <span class="s2">&#34;[</span><span class="nv">$timeStamp</span><span class="s2">] </span><span class="nv">$message</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$logMessage</span> <span class="p">|</span> <span class="nb">Out-File</span> <span class="n">-Append</span> <span class="n">-LiteralPath</span> <span class="nv">$verboseLogFile</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="c"># End Function</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nv">$confirmDeployment</span> <span class="o">-eq</span> <span class="mf">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Host</span> <span class="n">-ForegroundColor</span> <span class="n">Magenta</span> <span class="s2">&#34;</span><span class="se">`n</span><span class="s2">Nested ESXi Build Details:</span><span class="se">`n</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Host</span> <span class="n">-ForegroundColor</span> <span class="n">Yellow</span> <span class="s2">&#34;</span><span class="se">`n</span><span class="s2">---- vCenter Server used to Build Nested ESXi Hosts ----&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Host</span> <span class="n">-NoNewline</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span> <span class="s2">&#34;vCenter Server Address: &#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Host</span> <span class="n">-ForegroundColor</span> <span class="n">White</span> <span class="nv">$VIServer</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Host</span> <span class="n">-NoNewline</span> <span class="s2">&#34;</span><span class="se">`n</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Host</span> <span class="n">-NoNewline</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span> <span class="s2">&#34;VM Network: &#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Host</span> <span class="n">-ForegroundColor</span> <span class="n">White</span> <span class="nv">$VMNetwork</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Host</span> <span class="n">-NoNewline</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span> <span class="s2">&#34;VM Storage: &#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Host</span> <span class="n">-ForegroundColor</span> <span class="n">White</span> <span class="nv">$VMDatastore</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Host</span> <span class="n">-NoNewline</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span> <span class="s2">&#34;VM Cluster: &#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Host</span> <span class="n">-ForegroundColor</span> <span class="n">White</span> <span class="nv">$VMCluster</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nv">$deployNestedESXiVMsForMgmt</span> <span class="o">-eq</span> <span class="mf">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nb">Write-Host</span> <span class="n">-ForegroundColor</span> <span class="n">Yellow</span> <span class="s2">&#34;</span><span class="se">`n</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">Write-Host</span> <span class="n">-ForegroundColor</span> <span class="n">Yellow</span> <span class="s2">&#34;`---- vESXi Configuration for VCF Management Domain ----&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">Write-Host</span> <span class="n">-NoNewline</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span> <span class="s2">&#34;# of Nested ESXi VMs: &#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">Write-Host</span> <span class="n">-ForegroundColor</span> <span class="n">White</span> <span class="nv">$NestedESXiHostnameToIPsForManagementDomain</span><span class="p">.</span><span class="py">count</span>
</span></span><span class="line"><span class="cl">        <span class="nb">Write-Host</span> <span class="n">-NoNewline</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span> <span class="s2">&#34;-------IP Address(s): &#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">Write-Host</span> <span class="n">-ForegroundColor</span> <span class="n">White</span> <span class="nv">$NestedESXiHostnameToIPsForManagementDomain</span><span class="p">.</span><span class="py">Values</span>
</span></span><span class="line"><span class="cl">        <span class="nb">Write-Host</span> <span class="n">-NoNewline</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span> <span class="s2">&#34;----------------vCPU: &#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">Write-Host</span> <span class="n">-ForegroundColor</span> <span class="n">White</span> <span class="nv">$NestedESXiMGMTvCPU</span>
</span></span><span class="line"><span class="cl">        <span class="nb">Write-Host</span> <span class="n">-NoNewline</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span> <span class="s2">&#34;----------------vMEM: &#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">Write-Host</span> <span class="n">-ForegroundColor</span> <span class="n">White</span> <span class="s2">&#34;</span><span class="nv">$NestedESXiMGMTvMEM</span><span class="s2"> GB&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">Write-Host</span> <span class="n">-NoNewline</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span> <span class="s2">&#34;--------Caching VMDK: &#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">Write-Host</span> <span class="n">-ForegroundColor</span> <span class="n">White</span> <span class="s2">&#34;</span><span class="nv">$NestedESXiMGMTCachingvDisk</span><span class="s2"> GB&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">Write-Host</span> <span class="n">-NoNewline</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span> <span class="s2">&#34;-------Capacity VMDK: &#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">Write-Host</span> <span class="n">-ForegroundColor</span> <span class="n">White</span> <span class="s2">&#34;</span><span class="nv">$NestedESXiMGMTCapacityvDisk</span><span class="s2"> GB&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="c"># End If</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Host</span> <span class="n">-NoNewline</span> <span class="s2">&#34;</span><span class="se">`n</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Host</span> <span class="n">-NoNewline</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span> <span class="s2">&#34;Netmask: &#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Host</span> <span class="n">-ForegroundColor</span> <span class="n">White</span> <span class="nv">$VMNetmask</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Host</span> <span class="n">-NoNewline</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span> <span class="s2">&#34;Gateway: &#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Host</span> <span class="n">-ForegroundColor</span> <span class="n">White</span> <span class="nv">$VMGateway</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Host</span> <span class="n">-NoNewline</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span> <span class="s2">&#34;----DNS: &#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Host</span> <span class="n">-ForegroundColor</span> <span class="n">White</span> <span class="nv">$VMDNS</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Host</span> <span class="n">-NoNewline</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span> <span class="s2">&#34;----NTP: &#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Host</span> <span class="n">-ForegroundColor</span> <span class="n">White</span> <span class="nv">$VMNTP</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Host</span> <span class="n">-NoNewline</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span> <span class="s2">&#34;-Syslog: &#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Host</span> <span class="n">-ForegroundColor</span> <span class="n">White</span> <span class="nv">$VMSyslog</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Host</span> <span class="n">-NoNewline</span> <span class="s2">&#34;</span><span class="se">`n</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="c"># End If</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Connect to vCenter</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nv">$deployNestedESXiVMsForMgmt</span> <span class="o">-eq</span> <span class="mf">1</span> <span class="o">-or</span> <span class="nv">$deployNestedESXiVMsForWLD</span> <span class="o">-eq</span> <span class="mf">1</span> <span class="o">-or</span> <span class="nv">$deployCloudBuilder</span> <span class="o">-eq</span> <span class="mf">1</span> <span class="o">-or</span> <span class="nv">$moveVMsIntovApp</span> <span class="o">-eq</span> <span class="mf">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">New-LogEvent</span> <span class="s2">&#34;Connecting to Management vCenter Server: </span><span class="nv">$VIServer</span><span class="s2"> ...&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$viConnection</span> <span class="p">=</span> <span class="nb">Connect-VIServer</span> <span class="nv">$VIServer</span> <span class="n">-User</span> <span class="nv">$VIUsername</span> <span class="n">-Password</span> <span class="nv">$VIPassword</span> <span class="n">-WarningAction</span> <span class="n">SilentlyContinue</span> <span class="n">-Protocol</span> <span class="n">https</span> <span class="n">-Force</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">$datastore</span> <span class="p">=</span> <span class="nb">Get-Datastore</span> <span class="n">-Server</span> <span class="nv">$viConnection</span> <span class="n">-Name</span> <span class="nv">$VMDatastore</span> <span class="p">|</span> <span class="nb">Select-Object</span> <span class="n">-First</span> <span class="mf">1</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$cluster</span> <span class="p">=</span> <span class="nb">Get-Cluster</span> <span class="n">-Server</span> <span class="nv">$viConnection</span> <span class="n">-Name</span> <span class="nv">$VMCluster</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$vmhost</span> <span class="p">=</span> <span class="nv">$cluster</span> <span class="p">|</span> <span class="nb">Get-VMHost</span> <span class="p">|</span> <span class="nb">Get-Random</span> <span class="n">-Count</span> <span class="mf">1</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># --- Start Nested ESXi MGT Hosts Build</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nv">$deployNestedESXiVMsForMgmt</span> <span class="o">-eq</span> <span class="mf">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$NestedESXiHostnameToIPsForManagementDomain</span><span class="p">.</span><span class="py">GetEnumerator</span><span class="p">()</span> <span class="p">|</span> <span class="nb">Sort-Object</span> <span class="n">-Property</span> <span class="n">Value</span> <span class="p">|</span> <span class="nb">Foreach-Object</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$VMName</span> <span class="p">=</span> <span class="nv">$_</span><span class="p">.</span><span class="py">Key</span>
</span></span><span class="line"><span class="cl">        <span class="c">#Write-Host &#34;VMname:&#34;$VMName</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$VMIPAddress</span> <span class="p">=</span> <span class="nv">$_</span><span class="p">.</span><span class="py">Value</span>
</span></span><span class="line"><span class="cl">        <span class="c">#Write-Host &#34;IP:&#34;$VMIPAddress</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nv">$ovfconfig</span> <span class="p">=</span> <span class="nb">Get-OvfConfiguration</span> <span class="nv">$NestedESXiApplianceOVA</span>
</span></span><span class="line"><span class="cl">        <span class="c">#$ovfconfig.Common.guestinfo</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$networkMapLabel</span> <span class="p">=</span> <span class="p">(</span><span class="nv">$ovfconfig</span><span class="p">.</span><span class="py">ToHashTable</span><span class="p">().</span><span class="py">keys</span> <span class="p">|</span> <span class="nb">where </span><span class="p">{</span><span class="nv">$_</span> <span class="o">-Match</span> <span class="s2">&#34;NetworkMapping&#34;</span><span class="p">}).</span><span class="py">replace</span><span class="p">(</span><span class="s2">&#34;NetworkMapping.&#34;</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">).</span><span class="py">replace</span><span class="p">(</span><span class="s2">&#34;-&#34;</span><span class="p">,</span><span class="s2">&#34;_&#34;</span><span class="p">).</span><span class="py">replace</span><span class="p">(</span><span class="s2">&#34; &#34;</span><span class="p">,</span><span class="s2">&#34;_&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$ovfconfig</span><span class="p">.</span><span class="py">NetworkMapping</span><span class="p">.</span><span class="nv">$networkMapLabel</span><span class="p">.</span><span class="py">value</span> <span class="p">=</span> <span class="nv">$VMNetwork</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$ovfconfig</span><span class="p">.</span><span class="py">common</span><span class="p">.</span><span class="py">guestinfo</span><span class="p">.</span><span class="py">hostname</span><span class="p">.</span><span class="py">value</span> <span class="p">=</span> <span class="s2">&#34;</span><span class="nv">${VMName}</span><span class="s2">.</span><span class="nv">${VMDomain}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$ovfconfig</span><span class="p">.</span><span class="py">common</span><span class="p">.</span><span class="py">guestinfo</span><span class="p">.</span><span class="py">ipaddress</span><span class="p">.</span><span class="py">value</span> <span class="p">=</span> <span class="nv">$VMIPAddress</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$ovfconfig</span><span class="p">.</span><span class="py">common</span><span class="p">.</span><span class="py">guestinfo</span><span class="p">.</span><span class="py">netmask</span><span class="p">.</span><span class="py">value</span> <span class="p">=</span> <span class="nv">$VMNetmask</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$ovfconfig</span><span class="p">.</span><span class="py">common</span><span class="p">.</span><span class="py">guestinfo</span><span class="p">.</span><span class="py">gateway</span><span class="p">.</span><span class="py">value</span> <span class="p">=</span> <span class="nv">$VMGateway</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$ovfconfig</span><span class="p">.</span><span class="py">common</span><span class="p">.</span><span class="py">guestinfo</span><span class="p">.</span><span class="py">dns</span><span class="p">.</span><span class="py">value</span> <span class="p">=</span> <span class="nv">$VMDNS</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$ovfconfig</span><span class="p">.</span><span class="py">common</span><span class="p">.</span><span class="py">guestinfo</span><span class="p">.</span><span class="py">domain</span><span class="p">.</span><span class="py">value</span> <span class="p">=</span> <span class="nv">$VMDomain</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$ovfconfig</span><span class="p">.</span><span class="py">common</span><span class="p">.</span><span class="py">guestinfo</span><span class="p">.</span><span class="py">ntp</span><span class="p">.</span><span class="py">value</span> <span class="p">=</span> <span class="nv">$VMNTP</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$ovfconfig</span><span class="p">.</span><span class="py">common</span><span class="p">.</span><span class="py">guestinfo</span><span class="p">.</span><span class="py">syslog</span><span class="p">.</span><span class="py">value</span> <span class="p">=</span> <span class="nv">$VMSyslog</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$ovfconfig</span><span class="p">.</span><span class="py">common</span><span class="p">.</span><span class="py">guestinfo</span><span class="p">.</span><span class="py">password</span><span class="p">.</span><span class="py">value</span> <span class="p">=</span> <span class="nv">$VMPassword</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$ovfconfig</span><span class="p">.</span><span class="py">common</span><span class="p">.</span><span class="py">guestinfo</span><span class="p">.</span><span class="py">ssh</span><span class="p">.</span><span class="py">value</span> <span class="p">=</span> <span class="vm">$true</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nb">New-LogEvent</span> <span class="s2">&#34;Deploying Nested ESXi VM </span><span class="nv">$VMName</span><span class="s2"> ...&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$vm</span> <span class="p">=</span> <span class="nb">Import-VApp</span> <span class="n">-Source</span> <span class="nv">$NestedESXiApplianceOVA</span> <span class="n">-OvfConfiguration</span> <span class="nv">$ovfconfig</span> <span class="n">-Name</span> <span class="nv">$VMName</span> <span class="n">-Location</span> <span class="nv">$VMCluster</span> <span class="n">-VMHost</span> <span class="nv">$vmhost</span> <span class="n">-Datastore</span> <span class="nv">$datastore</span> <span class="n">-DiskStorageFormat</span> <span class="n">thin</span> <span class="n">-Force</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nb">New-LogEvent</span> <span class="s2">&#34;Adding vmnic2/vmnic3 to Nested ESXi VMs ...&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$vmPortGroup</span> <span class="p">=</span> <span class="nb">Get-VirtualNetwork</span> <span class="n">-Name</span> <span class="nv">$VMNetwork</span> <span class="n">-Location</span> <span class="p">(</span><span class="nv">$cluster</span> <span class="p">|</span> <span class="nb">Get-Datacenter</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nv">$vmPortGroup</span><span class="p">.</span><span class="py">NetworkType</span> <span class="o">-eq</span> <span class="s2">&#34;Distributed&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$vmPortGroup</span> <span class="p">=</span> <span class="nb">Get-VDPortgroup</span> <span class="n">-Name</span> <span class="nv">$VMNetwork</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$vmPortGroup</span> <span class="p">=</span> <span class="nv">$vmPortGroup</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="nb">New-NetworkAdapter</span> <span class="n">-VM</span> <span class="nv">$vm</span> <span class="n">-Type</span> <span class="n">Vmxnet3</span> <span class="n">-Portgroup</span> <span class="nv">$vmPortGroup</span><span class="p">.</span><span class="py">Name</span> <span class="n">-StartConnected</span> <span class="n">-confirm:</span><span class="vm">$false</span> <span class="p">|</span> <span class="nb">Out-File</span> <span class="n">-Append</span> <span class="n">-LiteralPath</span> <span class="nv">$verboseLogFile</span>
</span></span><span class="line"><span class="cl">            <span class="nb">New-NetworkAdapter</span> <span class="n">-VM</span> <span class="nv">$vm</span> <span class="n">-Type</span> <span class="n">Vmxnet3</span> <span class="n">-Portgroup</span> <span class="nv">$vmPortGroup</span><span class="p">.</span><span class="py">Name</span> <span class="n">-StartConnected</span> <span class="n">-confirm:</span><span class="vm">$false</span> <span class="p">|</span> <span class="nb">Out-File</span> <span class="n">-Append</span> <span class="n">-LiteralPath</span> <span class="nv">$verboseLogFile</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nb">New-NetworkAdapter</span> <span class="n">-VM</span> <span class="nv">$vm</span> <span class="n">-Type</span> <span class="n">Vmxnet3</span> <span class="n">-NetworkName</span> <span class="nv">$vmPortGroup</span><span class="p">.</span><span class="py">Name</span> <span class="n">-StartConnected</span> <span class="n">-confirm:</span><span class="vm">$false</span> <span class="p">|</span> <span class="nb">Out-File</span> <span class="n">-Append</span> <span class="n">-LiteralPath</span> <span class="nv">$verboseLogFile</span>
</span></span><span class="line"><span class="cl">            <span class="nb">New-NetworkAdapter</span> <span class="n">-VM</span> <span class="nv">$vm</span> <span class="n">-Type</span> <span class="n">Vmxnet3</span> <span class="n">-NetworkName</span> <span class="nv">$vmPortGroup</span><span class="p">.</span><span class="py">Name</span> <span class="n">-StartConnected</span> <span class="n">-confirm:</span><span class="vm">$false</span> <span class="p">|</span> <span class="nb">Out-File</span> <span class="n">-Append</span> <span class="n">-LiteralPath</span> <span class="nv">$verboseLogFile</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="c"># End If</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nv">$vm</span> <span class="p">|</span> <span class="nb">New-AdvancedSetting</span> <span class="n">-name</span> <span class="s2">&#34;ethernet2.filter4.name&#34;</span> <span class="n">-value</span> <span class="s2">&#34;dvfilter-maclearn&#34;</span> <span class="n">-confirm:</span><span class="vm">$false</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span> <span class="p">|</span> <span class="nb">Out-File</span> <span class="n">-Append</span> <span class="n">-LiteralPath</span> <span class="nv">$verboseLogFile</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$vm</span> <span class="p">|</span> <span class="nb">New-AdvancedSetting</span> <span class="n">-Name</span> <span class="s2">&#34;ethernet2.filter4.onFailure&#34;</span> <span class="n">-value</span> <span class="s2">&#34;failOpen&#34;</span> <span class="n">-confirm:</span><span class="vm">$false</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span> <span class="p">|</span> <span class="nb">Out-File</span> <span class="n">-Append</span> <span class="n">-LiteralPath</span> <span class="nv">$verboseLogFile</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nv">$vm</span> <span class="p">|</span> <span class="nb">New-AdvancedSetting</span> <span class="n">-name</span> <span class="s2">&#34;ethernet3.filter4.name&#34;</span> <span class="n">-value</span> <span class="s2">&#34;dvfilter-maclearn&#34;</span> <span class="n">-confirm:</span><span class="vm">$false</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span> <span class="p">|</span> <span class="nb">Out-File</span> <span class="n">-Append</span> <span class="n">-LiteralPath</span> <span class="nv">$verboseLogFile</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$vm</span> <span class="p">|</span> <span class="nb">New-AdvancedSetting</span> <span class="n">-Name</span> <span class="s2">&#34;ethernet3.filter4.onFailure&#34;</span> <span class="n">-value</span> <span class="s2">&#34;failOpen&#34;</span> <span class="n">-confirm:</span><span class="vm">$false</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span> <span class="p">|</span> <span class="nb">Out-File</span> <span class="n">-Append</span> <span class="n">-LiteralPath</span> <span class="nv">$verboseLogFile</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nb">New-LogEvent</span> <span class="s2">&#34;Updating vCPU Count to </span><span class="nv">$NestedESXiMGMTvCPU</span><span class="s2"> &amp; vMEM to </span><span class="nv">$NestedESXiMGMTvMEM</span><span class="s2"> GB ...&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">Set-VM</span> <span class="n">-Server</span> <span class="nv">$viConnection</span> <span class="n">-VM</span> <span class="nv">$vm</span> <span class="n">-NumCpu</span> <span class="nv">$NestedESXiMGMTvCPU</span> <span class="n">-CoresPerSocket</span> <span class="nv">$NestedESXiMGMTvCPU</span> <span class="n">-MemoryGB</span> <span class="nv">$NestedESXiMGMTvMEM</span> <span class="n">-Confirm:</span><span class="vm">$false</span> <span class="p">|</span> <span class="nb">Out-File</span> <span class="n">-Append</span> <span class="n">-LiteralPath</span> <span class="nv">$verboseLogFile</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nb">New-LogEvent</span> <span class="s2">&#34;Updating vSAN Cache VMDK size to </span><span class="nv">$NestedESXiMGMTCachingvDisk</span><span class="s2"> GB &amp; Capacity VMDK size to </span><span class="nv">$NestedESXiMGMTCapacityvDisk</span><span class="s2"> GB ...&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">Get-HardDisk</span> <span class="n">-Server</span> <span class="nv">$viConnection</span> <span class="n">-VM</span> <span class="nv">$vm</span> <span class="n">-Name</span> <span class="s2">&#34;Hard disk 2&#34;</span> <span class="p">|</span> <span class="nb">Set-HardDisk</span> <span class="n">-CapacityGB</span> <span class="nv">$NestedESXiMGMTCachingvDisk</span> <span class="n">-Confirm:</span><span class="vm">$false</span> <span class="p">|</span> <span class="nb">Out-File</span> <span class="n">-Append</span> <span class="n">-LiteralPath</span> <span class="nv">$verboseLogFile</span>
</span></span><span class="line"><span class="cl">        <span class="nb">Get-HardDisk</span> <span class="n">-Server</span> <span class="nv">$viConnection</span> <span class="n">-VM</span> <span class="nv">$vm</span> <span class="n">-Name</span> <span class="s2">&#34;Hard disk 3&#34;</span> <span class="p">|</span> <span class="nb">Set-HardDisk</span> <span class="n">-CapacityGB</span> <span class="nv">$NestedESXiMGMTCapacityvDisk</span> <span class="n">-Confirm:</span><span class="vm">$false</span> <span class="p">|</span> <span class="nb">Out-File</span> <span class="n">-Append</span> <span class="n">-LiteralPath</span> <span class="nv">$verboseLogFile</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nb">New-LogEvent</span> <span class="s2">&#34;Updating vSAN Boot Disk size to </span><span class="nv">$NestedESXiMGMTBootDisk</span><span class="s2"> GB ...&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">Get-HardDisk</span> <span class="n">-Server</span> <span class="nv">$viConnection</span> <span class="n">-VM</span> <span class="nv">$vm</span> <span class="n">-Name</span> <span class="s2">&#34;Hard disk 1&#34;</span> <span class="p">|</span> <span class="nb">Set-HardDisk</span> <span class="n">-CapacityGB</span> <span class="nv">$NestedESXiMGMTBootDisk</span> <span class="n">-Confirm:</span><span class="vm">$false</span> <span class="p">|</span> <span class="nb">Out-File</span> <span class="n">-Append</span> <span class="n">-LiteralPath</span> <span class="nv">$verboseLogFile</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nb">New-LogEvent</span> <span class="s2">&#34;Powering On </span><span class="nv">$vmname</span><span class="s2"> ...&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$vm</span> <span class="p">|</span> <span class="nb">Start-Vm</span> <span class="n">-RunAsync</span> <span class="p">|</span> <span class="nb">Out-Null</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="c"># End Foreach</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="c"># End If</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nv">$deployNestedESXiVMsForMgmt</span> <span class="o">-eq</span> <span class="mf">1</span> <span class="o">-or</span> <span class="nv">$deployNestedESXiVMsForWLD</span> <span class="o">-eq</span> <span class="mf">1</span> <span class="o">-or</span> <span class="nv">$deployCloudBuilder</span> <span class="o">-eq</span> <span class="mf">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">New-LogEvent</span> <span class="s2">&#34;Disconnecting from </span><span class="nv">$VIServer</span><span class="s2"> ...&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Disconnect-VIServer</span> <span class="n">-Server</span> <span class="nv">$viConnection</span> <span class="n">-Confirm:</span><span class="vm">$false</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$EndTime</span> <span class="p">=</span> <span class="nb">Get-Date</span>
</span></span><span class="line"><span class="cl"><span class="nv">$duration</span> <span class="p">=</span> <span class="p">[</span><span class="no">math</span><span class="p">]::</span><span class="n">Round</span><span class="p">((</span><span class="nb">New-TimeSpan</span> <span class="n">-Start</span> <span class="nv">$StartTime</span> <span class="n">-End</span> <span class="nv">$EndTime</span><span class="p">).</span><span class="n">TotalMinutes</span><span class="p">,</span><span class="mf">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">New-LogEvent</span> <span class="s2">&#34;VCF Lab Nested ESXi Host Build Complete!&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">New-LogEvent</span> <span class="s2">&#34;StartTime: </span><span class="nv">$StartTime</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">New-LogEvent</span> <span class="s2">&#34;EndTime: </span><span class="nv">$EndTime</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">New-LogEvent</span> <span class="s2">&#34;Duration: </span><span class="nv">$duration</span><span class="s2"> minutes to Deploy Nested ESXi Hosts&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><hr>
<p><strong>Script Overview - Step 2</strong></p>
<p><strong>Purpose:</strong>
This script automates the setup of VCF Cloud Builder and prepares the configuration required to deploy the VCF Management Domain.</p>
<p><strong>Steps Performed:</strong></p>
<ul>
<li>Creates the Cloud Builder VM – Deploys the virtual machine needed to orchestrate the VCF installation.</li>
<li>Generate the JSON Configuration File – Creates the input file required by Cloud Builder to install the VCF Management Domain.
<ul>
<li>The step to create the JSON file is worth reviewing. It is the easiest method I have found to generate the JSON file required for VCF Cloud Builder.</li>
</ul>
</li>
<li>Update this script with names and IP addresses that match your lab environment.</li>
</ul>
<hr>
<p><small><span style="color: red; font-weight: bold;">Click arrow to expand the PowerShell code:</span></small><br>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span><span class="lnt">263
</span><span class="lnt">264
</span><span class="lnt">265
</span><span class="lnt">266
</span><span class="lnt">267
</span><span class="lnt">268
</span><span class="lnt">269
</span><span class="lnt">270
</span><span class="lnt">271
</span><span class="lnt">272
</span><span class="lnt">273
</span><span class="lnt">274
</span><span class="lnt">275
</span><span class="lnt">276
</span><span class="lnt">277
</span><span class="lnt">278
</span><span class="lnt">279
</span><span class="lnt">280
</span><span class="lnt">281
</span><span class="lnt">282
</span><span class="lnt">283
</span><span class="lnt">284
</span><span class="lnt">285
</span><span class="lnt">286
</span><span class="lnt">287
</span><span class="lnt">288
</span><span class="lnt">289
</span><span class="lnt">290
</span><span class="lnt">291
</span><span class="lnt">292
</span><span class="lnt">293
</span><span class="lnt">294
</span><span class="lnt">295
</span><span class="lnt">296
</span><span class="lnt">297
</span><span class="lnt">298
</span><span class="lnt">299
</span><span class="lnt">300
</span><span class="lnt">301
</span><span class="lnt">302
</span><span class="lnt">303
</span><span class="lnt">304
</span><span class="lnt">305
</span><span class="lnt">306
</span><span class="lnt">307
</span><span class="lnt">308
</span><span class="lnt">309
</span><span class="lnt">310
</span><span class="lnt">311
</span><span class="lnt">312
</span><span class="lnt">313
</span><span class="lnt">314
</span><span class="lnt">315
</span><span class="lnt">316
</span><span class="lnt">317
</span><span class="lnt">318
</span><span class="lnt">319
</span><span class="lnt">320
</span><span class="lnt">321
</span><span class="lnt">322
</span><span class="lnt">323
</span><span class="lnt">324
</span><span class="lnt">325
</span><span class="lnt">326
</span><span class="lnt">327
</span><span class="lnt">328
</span><span class="lnt">329
</span><span class="lnt">330
</span><span class="lnt">331
</span><span class="lnt">332
</span><span class="lnt">333
</span><span class="lnt">334
</span><span class="lnt">335
</span><span class="lnt">336
</span><span class="lnt">337
</span><span class="lnt">338
</span><span class="lnt">339
</span><span class="lnt">340
</span><span class="lnt">341
</span><span class="lnt">342
</span><span class="lnt">343
</span><span class="lnt">344
</span><span class="lnt">345
</span><span class="lnt">346
</span><span class="lnt">347
</span><span class="lnt">348
</span><span class="lnt">349
</span><span class="lnt">350
</span><span class="lnt">351
</span><span class="lnt">352
</span><span class="lnt">353
</span><span class="lnt">354
</span><span class="lnt">355
</span><span class="lnt">356
</span><span class="lnt">357
</span><span class="lnt">358
</span><span class="lnt">359
</span><span class="lnt">360
</span><span class="lnt">361
</span><span class="lnt">362
</span><span class="lnt">363
</span><span class="lnt">364
</span><span class="lnt">365
</span><span class="lnt">366
</span><span class="lnt">367
</span><span class="lnt">368
</span><span class="lnt">369
</span><span class="lnt">370
</span><span class="lnt">371
</span><span class="lnt">372
</span><span class="lnt">373
</span><span class="lnt">374
</span><span class="lnt">375
</span><span class="lnt">376
</span><span class="lnt">377
</span><span class="lnt">378
</span><span class="lnt">379
</span><span class="lnt">380
</span><span class="lnt">381
</span><span class="lnt">382
</span><span class="lnt">383
</span><span class="lnt">384
</span><span class="lnt">385
</span><span class="lnt">386
</span><span class="lnt">387
</span><span class="lnt">388
</span><span class="lnt">389
</span><span class="lnt">390
</span><span class="lnt">391
</span><span class="lnt">392
</span><span class="lnt">393
</span><span class="lnt">394
</span><span class="lnt">395
</span><span class="lnt">396
</span><span class="lnt">397
</span><span class="lnt">398
</span><span class="lnt">399
</span><span class="lnt">400
</span><span class="lnt">401
</span><span class="lnt">402
</span><span class="lnt">403
</span><span class="lnt">404
</span><span class="lnt">405
</span><span class="lnt">406
</span><span class="lnt">407
</span><span class="lnt">408
</span><span class="lnt">409
</span><span class="lnt">410
</span><span class="lnt">411
</span><span class="lnt">412
</span><span class="lnt">413
</span><span class="lnt">414
</span><span class="lnt">415
</span><span class="lnt">416
</span><span class="lnt">417
</span><span class="lnt">418
</span><span class="lnt">419
</span><span class="lnt">420
</span><span class="lnt">421
</span><span class="lnt">422
</span><span class="lnt">423
</span><span class="lnt">424
</span><span class="lnt">425
</span><span class="lnt">426
</span><span class="lnt">427
</span><span class="lnt">428
</span><span class="lnt">429
</span><span class="lnt">430
</span><span class="lnt">431
</span><span class="lnt">432
</span><span class="lnt">433
</span><span class="lnt">434
</span><span class="lnt">435
</span><span class="lnt">436
</span><span class="lnt">437
</span><span class="lnt">438
</span><span class="lnt">439
</span><span class="lnt">440
</span><span class="lnt">441
</span><span class="lnt">442
</span><span class="lnt">443
</span><span class="lnt">444
</span><span class="lnt">445
</span><span class="lnt">446
</span><span class="lnt">447
</span><span class="lnt">448
</span><span class="lnt">449
</span><span class="lnt">450
</span><span class="lnt">451
</span><span class="lnt">452
</span><span class="lnt">453
</span><span class="lnt">454
</span><span class="lnt">455
</span><span class="lnt">456
</span><span class="lnt">457
</span><span class="lnt">458
</span><span class="lnt">459
</span><span class="lnt">460
</span><span class="lnt">461
</span><span class="lnt">462
</span><span class="lnt">463
</span><span class="lnt">464
</span><span class="lnt">465
</span><span class="lnt">466
</span><span class="lnt">467
</span><span class="lnt">468
</span><span class="lnt">469
</span><span class="lnt">470
</span><span class="lnt">471
</span><span class="lnt">472
</span><span class="lnt">473
</span><span class="lnt">474
</span><span class="lnt">475
</span><span class="lnt">476
</span><span class="lnt">477
</span><span class="lnt">478
</span><span class="lnt">479
</span><span class="lnt">480
</span><span class="lnt">481
</span><span class="lnt">482
</span><span class="lnt">483
</span><span class="lnt">484
</span><span class="lnt">485
</span><span class="lnt">486
</span><span class="lnt">487
</span><span class="lnt">488
</span><span class="lnt">489
</span><span class="lnt">490
</span><span class="lnt">491
</span><span class="lnt">492
</span><span class="lnt">493
</span><span class="lnt">494
</span><span class="lnt">495
</span><span class="lnt">496
</span><span class="lnt">497
</span><span class="lnt">498
</span><span class="lnt">499
</span><span class="lnt">500
</span><span class="lnt">501
</span><span class="lnt">502
</span><span class="lnt">503
</span><span class="lnt">504
</span><span class="lnt">505
</span><span class="lnt">506
</span><span class="lnt">507
</span><span class="lnt">508
</span><span class="lnt">509
</span><span class="lnt">510
</span><span class="lnt">511
</span><span class="lnt">512
</span><span class="lnt">513
</span><span class="lnt">514
</span><span class="lnt">515
</span><span class="lnt">516
</span><span class="lnt">517
</span><span class="lnt">518
</span><span class="lnt">519
</span><span class="lnt">520
</span><span class="lnt">521
</span><span class="lnt">522
</span><span class="lnt">523
</span><span class="lnt">524
</span><span class="lnt">525
</span><span class="lnt">526
</span><span class="lnt">527
</span><span class="lnt">528
</span><span class="lnt">529
</span><span class="lnt">530
</span><span class="lnt">531
</span><span class="lnt">532
</span><span class="lnt">533
</span><span class="lnt">534
</span><span class="lnt">535
</span><span class="lnt">536
</span><span class="lnt">537
</span><span class="lnt">538
</span><span class="lnt">539
</span><span class="lnt">540
</span><span class="lnt">541
</span><span class="lnt">542
</span><span class="lnt">543
</span><span class="lnt">544
</span><span class="lnt">545
</span><span class="lnt">546
</span><span class="lnt">547
</span><span class="lnt">548
</span><span class="lnt">549
</span><span class="lnt">550
</span><span class="lnt">551
</span><span class="lnt">552
</span><span class="lnt">553
</span><span class="lnt">554
</span><span class="lnt">555
</span><span class="lnt">556
</span><span class="lnt">557
</span><span class="lnt">558
</span><span class="lnt">559
</span><span class="lnt">560
</span><span class="lnt">561
</span><span class="lnt">562
</span><span class="lnt">563
</span><span class="lnt">564
</span><span class="lnt">565
</span><span class="lnt">566
</span><span class="lnt">567
</span><span class="lnt">568
</span><span class="lnt">569
</span><span class="lnt">570
</span><span class="lnt">571
</span><span class="lnt">572
</span><span class="lnt">573
</span><span class="lnt">574
</span><span class="lnt">575
</span><span class="lnt">576
</span><span class="lnt">577
</span><span class="lnt">578
</span><span class="lnt">579
</span><span class="lnt">580
</span><span class="lnt">581
</span><span class="lnt">582
</span><span class="lnt">583
</span><span class="lnt">584
</span><span class="lnt">585
</span><span class="lnt">586
</span><span class="lnt">587
</span><span class="lnt">588
</span><span class="lnt">589
</span><span class="lnt">590
</span><span class="lnt">591
</span><span class="lnt">592
</span><span class="lnt">593
</span><span class="lnt">594
</span><span class="lnt">595
</span><span class="lnt">596
</span><span class="lnt">597
</span><span class="lnt">598
</span><span class="lnt">599
</span><span class="lnt">600
</span><span class="lnt">601
</span><span class="lnt">602
</span><span class="lnt">603
</span><span class="lnt">604
</span><span class="lnt">605
</span><span class="lnt">606
</span><span class="lnt">607
</span><span class="lnt">608
</span><span class="lnt">609
</span><span class="lnt">610
</span><span class="lnt">611
</span><span class="lnt">612
</span><span class="lnt">613
</span><span class="lnt">614
</span><span class="lnt">615
</span><span class="lnt">616
</span><span class="lnt">617
</span><span class="lnt">618
</span><span class="lnt">619
</span><span class="lnt">620
</span><span class="lnt">621
</span><span class="lnt">622
</span><span class="lnt">623
</span><span class="lnt">624
</span><span class="lnt">625
</span><span class="lnt">626
</span><span class="lnt">627
</span><span class="lnt">628
</span><span class="lnt">629
</span><span class="lnt">630
</span><span class="lnt">631
</span><span class="lnt">632
</span><span class="lnt">633
</span><span class="lnt">634
</span><span class="lnt">635
</span><span class="lnt">636
</span><span class="lnt">637
</span><span class="lnt">638
</span><span class="lnt">639
</span><span class="lnt">640
</span><span class="lnt">641
</span><span class="lnt">642
</span><span class="lnt">643
</span><span class="lnt">644
</span><span class="lnt">645
</span><span class="lnt">646
</span><span class="lnt">647
</span><span class="lnt">648
</span><span class="lnt">649
</span><span class="lnt">650
</span><span class="lnt">651
</span><span class="lnt">652
</span><span class="lnt">653
</span><span class="lnt">654
</span><span class="lnt">655
</span><span class="lnt">656
</span><span class="lnt">657
</span><span class="lnt">658
</span><span class="lnt">659
</span><span class="lnt">660
</span><span class="lnt">661
</span><span class="lnt">662
</span><span class="lnt">663
</span><span class="lnt">664
</span><span class="lnt">665
</span><span class="lnt">666
</span><span class="lnt">667
</span><span class="lnt">668
</span><span class="lnt">669
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="c"># Script to create Cloud Builder VM and json file</span>
</span></span><span class="line"><span class="cl"><span class="c"># Author: Dale Hassinger</span>
</span></span><span class="line"><span class="cl"><span class="c"># Based on Script by: William Lam and some other examples I saw on vCommunity sites</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># vCenter Server used to deploy VMware Cloud Foundation Lab</span>
</span></span><span class="line"><span class="cl"><span class="nv">$VIServer</span>   <span class="p">=</span> <span class="s2">&#34;192.168.6.100&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$VIUsername</span> <span class="p">=</span> <span class="s2">&#34;administrator@vcrocs.local&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$VIPassword</span> <span class="p">=</span> <span class="s2">&#34;VMware1!&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Full Path to Cloud Builder OVA</span>
</span></span><span class="line"><span class="cl"><span class="c">#$CloudBuilderOVA = &#34;/Users/dalehassinger/Downloads/VMware-Cloud-Builder-5.2.0.0-24108943_OVF10.ova&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$CloudBuilderOVA</span> <span class="p">=</span> <span class="s2">&#34;/Users/dalehassinger/Downloads/VMware-Cloud-Builder-5.2.1.0-24307856_OVF10.ova&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># VCF Licenses or leave blank for evaluation mode (requires VCF 5.1.1 or later)</span>
</span></span><span class="line"><span class="cl"><span class="nv">$VCSALicense</span> <span class="p">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$ESXILicense</span> <span class="p">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$VSANLicense</span> <span class="p">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$NSXLicense</span>  <span class="p">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># VCF Configurations</span>
</span></span><span class="line"><span class="cl"><span class="nv">$VCFManagementDomainPoolName</span>  <span class="p">=</span> <span class="s2">&#34;vcf-m01-rp01&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$VCFManagementDomainJSONFile</span>  <span class="p">=</span> <span class="s2">&#34;vcf-mgmt.json&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Cloud Builder Configurations</span>
</span></span><span class="line"><span class="cl"><span class="nv">$CloudbuilderVMHostname</span>    <span class="p">=</span> <span class="s2">&#34;vcf-m01-cb01&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$CloudbuilderFQDN</span>          <span class="p">=</span> <span class="s2">&#34;vcf-m01-cb01.vcrocs.local&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$CloudbuilderIP</span>            <span class="p">=</span> <span class="s2">&#34;192.168.4.180&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$CloudbuilderAdminUsername</span> <span class="p">=</span> <span class="s2">&#34;admin&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$CloudbuilderAdminPassword</span> <span class="p">=</span> <span class="s2">&#34;VMw@re123!VMw@re123!&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$CloudbuilderRootPassword</span>  <span class="p">=</span> <span class="s2">&#34;VMw@re123!VMw@re123!&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># SDDC Manager Configuration</span>
</span></span><span class="line"><span class="cl"><span class="nv">$SddcManagerHostname</span>      <span class="p">=</span> <span class="s2">&#34;vcf-m01-sddcm01&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$SddcManagerIP</span>            <span class="p">=</span> <span class="s2">&#34;192.168.4.181&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$SddcManagerVcfPassword</span>   <span class="p">=</span> <span class="s2">&#34;VMware1!VMware1!&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$SddcManagerRootPassword</span>  <span class="p">=</span> <span class="s2">&#34;VMware1!VMware1!&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$SddcManagerRestPassword</span>  <span class="p">=</span> <span class="s2">&#34;VMware1!VMware1!&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$SddcManagerLocalPassword</span> <span class="p">=</span> <span class="s2">&#34;VMware1!VMware1!&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$NestedESXiHostnameToIPsForManagementDomain</span> <span class="p">=</span> <span class="vm">@</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;VCF-DDC-ESX179&#34;</span> <span class="p">=</span> <span class="s2">&#34;192.168.4.179&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Nested ESXi VM Resources for Management Domain</span>
</span></span><span class="line"><span class="cl"><span class="nv">$NestedESXiMGMTvCPU</span>          <span class="p">=</span> <span class="s2">&#34;12&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$NestedESXiMGMTvMEM</span>          <span class="p">=</span> <span class="s2">&#34;78&#34;</span> <span class="c">#GB</span>
</span></span><span class="line"><span class="cl"><span class="nv">$NestedESXiMGMTCachingvDisk</span>  <span class="p">=</span> <span class="s2">&#34;4&#34;</span> <span class="c">#GB</span>
</span></span><span class="line"><span class="cl"><span class="nv">$NestedESXiMGMTCapacityvDisk</span> <span class="p">=</span> <span class="s2">&#34;500&#34;</span> <span class="c">#GB</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Nested ESXi VM Resources for Workload Domain</span>
</span></span><span class="line"><span class="cl"><span class="nv">$NestedESXiWLDvCPU</span>          <span class="p">=</span> <span class="s2">&#34;8&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$NestedESXiWLDvMEM</span>          <span class="p">=</span> <span class="s2">&#34;36&#34;</span> <span class="c">#GB</span>
</span></span><span class="line"><span class="cl"><span class="nv">$NestedESXiWLDCachingvDisk</span>  <span class="p">=</span> <span class="s2">&#34;4&#34;</span> <span class="c">#GB</span>
</span></span><span class="line"><span class="cl"><span class="nv">$NestedESXiWLDCapacityvDisk</span> <span class="p">=</span> <span class="s2">&#34;200&#34;</span> <span class="c">#GB</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># ESXi Network Configuration</span>
</span></span><span class="line"><span class="cl"><span class="nv">$NestedESXiManagementNetworkCidr</span> <span class="p">=</span> <span class="s2">&#34;192.168.4.0/22&#34;</span> <span class="c"># should match $VMNetwork configuration</span>
</span></span><span class="line"><span class="cl"><span class="nv">$NestedESXivMotionNetworkCidr</span>    <span class="p">=</span> <span class="s2">&#34;192.168.8.0/24&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$NestedESXivSANNetworkCidr</span>       <span class="p">=</span> <span class="s2">&#34;192.168.9.0/24&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$NestedESXiNSXTepNetworkCidr</span>     <span class="p">=</span> <span class="s2">&#34;192.168.10.0/24&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># vCenter Configuration</span>
</span></span><span class="line"><span class="cl"><span class="nv">$VCSAName</span>         <span class="p">=</span> <span class="s2">&#34;vcf-m01-vc01&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$VCSAIP</span>           <span class="p">=</span> <span class="s2">&#34;192.168.4.182&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$VCSARootPassword</span> <span class="p">=</span> <span class="s2">&#34;VMware1!&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$VCSASSOPassword</span>  <span class="p">=</span> <span class="s2">&#34;VMware1!&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$EnableVCLM</span>       <span class="p">=</span> <span class="vm">$true</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># NSX Configuration</span>
</span></span><span class="line"><span class="cl"><span class="nv">$NSXManagerSize</span>          <span class="p">=</span> <span class="s2">&#34;medium&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$NSXManagerVIPHostname</span>   <span class="p">=</span> <span class="s2">&#34;vcf-m01-nsx01&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$NSXManagerVIPIP</span>         <span class="p">=</span> <span class="s2">&#34;192.168.4.183&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$NSXManagerNode1Hostname</span> <span class="p">=</span> <span class="s2">&#34;vcf-m01-nsx01a&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$NSXManagerNode1IP</span>       <span class="p">=</span> <span class="s2">&#34;192.168.4.184&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$NSXRootPassword</span>         <span class="p">=</span> <span class="s2">&#34;VMware1!VMware1!&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$NSXAdminPassword</span>        <span class="p">=</span> <span class="s2">&#34;VMware1!VMware1!&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$NSXAuditPassword</span>        <span class="p">=</span> <span class="s2">&#34;VMware1!VMware1!&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># General Deployment Configuration for Nested ESXi &amp; Cloud Builder VM</span>
</span></span><span class="line"><span class="cl"><span class="c"># This is information from you current vCenter lab environment</span>
</span></span><span class="line"><span class="cl"><span class="nv">$VMDatacenter</span> <span class="p">=</span> <span class="s2">&#34;Datacenter-DB-01&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$VMCluster</span>    <span class="p">=</span> <span class="s2">&#34;VCF_LAB&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$VMNetwork</span>    <span class="p">=</span> <span class="s2">&#34;VMs&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$VMDatastore</span>  <span class="p">=</span> <span class="s2">&#34;ESX-04-2TB&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$VMNetmask</span>    <span class="p">=</span> <span class="s2">&#34;255.255.252.0&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$VMGateway</span>    <span class="p">=</span> <span class="s2">&#34;192.168.4.1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$VMDNS</span>        <span class="p">=</span> <span class="s2">&#34;192.168.6.1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$VMNTP</span>        <span class="p">=</span> <span class="s2">&#34;time.google.com&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$VMPassword</span>   <span class="p">=</span> <span class="s2">&#34;VMware1!&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$VMDomain</span>     <span class="p">=</span> <span class="s2">&#34;vcrocs.local&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$VMSyslog</span>     <span class="p">=</span> <span class="s2">&#34;192.168.6.94&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$VMFolder</span>     <span class="p">=</span> <span class="s2">&#34;VCF-VMs&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">#### DO NOT EDIT BEYOND HERE ####</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$verboseLogFile</span>    <span class="p">=</span> <span class="s2">&#34;vcf-lab-deployment.log&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$random_string</span>     <span class="p">=</span> <span class="n">-join</span> <span class="p">((</span><span class="mf">65</span><span class="p">.</span><span class="mf">.90</span><span class="p">)</span> <span class="p">+</span> <span class="p">(</span><span class="mf">97</span><span class="p">.</span><span class="mf">.122</span><span class="p">)</span> <span class="p">|</span> <span class="nb">Get-Random</span> <span class="n">-Count</span> <span class="mf">8</span> <span class="p">|</span> <span class="p">%</span> <span class="p">{[</span><span class="no">char</span><span class="p">]</span><span class="nv">$_</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="nv">$VAppName</span>          <span class="p">=</span> <span class="s2">&#34;Nested-VCF-Lab-</span><span class="nv">$random_string</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$SeparateNSXSwitch</span> <span class="p">=</span> <span class="vm">$false</span>
</span></span><span class="line"><span class="cl"><span class="nv">$VCFVersion</span>        <span class="p">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$preCheck</span>                   <span class="p">=</span> <span class="mf">1</span>
</span></span><span class="line"><span class="cl"><span class="nv">$confirmDeployment</span>          <span class="p">=</span> <span class="mf">1</span>
</span></span><span class="line"><span class="cl"><span class="nv">$deployNestedESXiVMsForMgmt</span> <span class="p">=</span> <span class="mf">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># WLD Setup</span>
</span></span><span class="line"><span class="cl"><span class="nv">$deployNestedESXiVMsForWLD</span>     <span class="p">=</span> <span class="mf">0</span>
</span></span><span class="line"><span class="cl"><span class="nv">$deployCloudBuilder</span>            <span class="p">=</span> <span class="mf">1</span>
</span></span><span class="line"><span class="cl"><span class="nv">$moveVMsIntovApp</span>               <span class="p">=</span> <span class="mf">1</span>
</span></span><span class="line"><span class="cl"><span class="nv">$generateMgmJson</span>               <span class="p">=</span> <span class="mf">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$StartTime</span> <span class="p">=</span> <span class="nb">Get-Date</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">Function</span><span class="w"> </span><span class="nb">New-LogEvent</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">param</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">[</span><span class="nb">Parameter</span><span class="p">(</span><span class="na">Mandatory</span><span class="p">=</span><span class="vm">$true</span><span class="p">)][</span><span class="no">String</span><span class="p">]</span><span class="nv">$message</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">[</span><span class="nb">Parameter</span><span class="p">(</span><span class="na">Mandatory</span><span class="p">=</span><span class="vm">$false</span><span class="p">)][</span><span class="no">String</span><span class="p">]</span><span class="nv">$color</span><span class="p">=</span><span class="s2">&#34;green&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">$timeStamp</span> <span class="p">=</span> <span class="nb">Get-Date</span> <span class="n">-Format</span> <span class="s2">&#34;MM-dd-yyyy_hh:mm:ss&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Host</span> <span class="n">-NoNewline</span> <span class="n">-ForegroundColor</span> <span class="n">White</span> <span class="s2">&#34;[</span><span class="nv">$timestamp</span><span class="s2">]&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Host</span> <span class="n">-ForegroundColor</span> <span class="nv">$color</span> <span class="s2">&#34; </span><span class="nv">$message</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$logMessage</span> <span class="p">=</span> <span class="s2">&#34;[</span><span class="nv">$timeStamp</span><span class="s2">] </span><span class="nv">$message</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$logMessage</span> <span class="p">|</span> <span class="nb">Out-File</span> <span class="n">-Append</span> <span class="n">-LiteralPath</span> <span class="nv">$verboseLogFile</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="c"># End Function</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nv">$preCheck</span> <span class="o">-eq</span> <span class="mf">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c"># Detect VCF version based on Cloud Builder OVA (support is 5.1.0+)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nv">$CloudBuilderOVA</span> <span class="o">-match</span> <span class="s2">&#34;5.2.0&#34;</span> <span class="o">-or</span> <span class="nv">$CloudBuilderOVA</span> <span class="o">-match</span> <span class="s2">&#34;5.2.1&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$VCFVersion</span> <span class="p">=</span> <span class="s2">&#34;5.2.0&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">elseif</span><span class="p">(</span><span class="nv">$CloudBuilderOVA</span> <span class="o">-match</span> <span class="s2">&#34;5.1.1&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$VCFVersion</span> <span class="p">=</span> <span class="s2">&#34;5.1.1&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">elseif</span><span class="p">(</span><span class="nv">$CloudBuilderOVA</span> <span class="o">-match</span> <span class="s2">&#34;5.1.0&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$VCFVersion</span> <span class="p">=</span> <span class="s2">&#34;5.1.0&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$VCFVersion</span> <span class="p">=</span> <span class="vm">$null</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nv">$VCFVersion</span> <span class="o">-eq</span> <span class="vm">$null</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nb">Write-Host</span> <span class="n">-ForegroundColor</span> <span class="n">Red</span> <span class="s2">&#34;</span><span class="se">`n</span><span class="s2">Only VCF 5.1.0+ is currently supported ...</span><span class="se">`n</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">exit</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nv">$VCFVersion</span> <span class="o">-ge</span> <span class="s2">&#34;5.2.0&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nb">write-host</span> <span class="s2">&#34;here&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span> <span class="nv">$CloudbuilderAdminPassword</span><span class="p">.</span><span class="py">ToCharArray</span><span class="p">().</span><span class="py">count</span> <span class="o">-lt</span> <span class="mf">15</span> <span class="o">-or</span> <span class="nv">$CloudbuilderRootPassword</span><span class="p">.</span><span class="py">ToCharArray</span><span class="p">().</span><span class="py">count</span> <span class="o">-lt</span> <span class="mf">15</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nb">Write-Host</span> <span class="n">-ForegroundColor</span> <span class="n">Red</span> <span class="s2">&#34;</span><span class="se">`n</span><span class="s2">Cloud Builder passwords must be 15 characters or longer ...</span><span class="se">`n</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="n">exit</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(!(</span><span class="nb">Test-Path</span> <span class="nv">$NestedESXiApplianceOVA</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nb">Write-Host</span> <span class="n">-ForegroundColor</span> <span class="n">Red</span> <span class="s2">&#34;</span><span class="se">`n</span><span class="s2">Unable to find </span><span class="nv">$NestedESXiApplianceOVA</span><span class="s2"> ...</span><span class="se">`n</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">exit</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(!(</span><span class="nb">Test-Path</span> <span class="nv">$CloudBuilderOVA</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nb">Write-Host</span> <span class="n">-ForegroundColor</span> <span class="n">Red</span> <span class="s2">&#34;</span><span class="se">`n</span><span class="s2">Unable to find </span><span class="nv">$CloudBuilderOVA</span><span class="s2"> ...</span><span class="se">`n</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">exit</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nv">$PSVersionTable</span><span class="p">.</span><span class="py">PSEdition</span> <span class="o">-ne</span> <span class="s2">&#34;Core&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nb">Write-Host</span> <span class="n">-ForegroundColor</span> <span class="n">Red</span> <span class="s2">&#34;</span><span class="se">`t</span><span class="s2">PowerShell Core was not detected, please install that before continuing ... </span><span class="se">`n</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">exit</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nv">$confirmDeployment</span> <span class="o">-eq</span> <span class="mf">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Host</span> <span class="n">-ForegroundColor</span> <span class="n">Magenta</span> <span class="s2">&#34;</span><span class="se">`n</span><span class="s2">Please confirm the following configuration will be deployed:</span><span class="se">`n</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Host</span> <span class="n">-ForegroundColor</span> <span class="n">Yellow</span> <span class="s2">&#34;---- VCF Automated Lab Deployment Configuration ---- &#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Host</span> <span class="n">-NoNewline</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span> <span class="s2">&#34;VMware Cloud Foundation Version: &#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Host</span> <span class="n">-ForegroundColor</span> <span class="n">White</span> <span class="nv">$VCFVersion</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Host</span> <span class="n">-NoNewline</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span> <span class="s2">&#34;Nested ESXi Image Path: &#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Host</span> <span class="n">-ForegroundColor</span> <span class="n">White</span> <span class="nv">$NestedESXiApplianceOVA</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Host</span> <span class="n">-NoNewline</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span> <span class="s2">&#34;Cloud Builder Image Path: &#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Host</span> <span class="n">-ForegroundColor</span> <span class="n">White</span> <span class="nv">$CloudBuilderOVA</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Host</span> <span class="n">-ForegroundColor</span> <span class="n">Yellow</span> <span class="s2">&#34;</span><span class="se">`n</span><span class="s2">---- vCenter Server Deployment Target Configuration ----&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Host</span> <span class="n">-NoNewline</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span> <span class="s2">&#34;vCenter Server Address: &#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Host</span> <span class="n">-ForegroundColor</span> <span class="n">White</span> <span class="nv">$VIServer</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Host</span> <span class="n">-NoNewline</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span> <span class="s2">&#34;VM Network: &#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Host</span> <span class="n">-ForegroundColor</span> <span class="n">White</span> <span class="nv">$VMNetwork</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Host</span> <span class="n">-NoNewline</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span> <span class="s2">&#34;VM Storage: &#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Host</span> <span class="n">-ForegroundColor</span> <span class="n">White</span> <span class="nv">$VMDatastore</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Host</span> <span class="n">-NoNewline</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span> <span class="s2">&#34;VM Cluster: &#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Host</span> <span class="n">-ForegroundColor</span> <span class="n">White</span> <span class="nv">$VMCluster</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Host</span> <span class="n">-NoNewline</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span> <span class="s2">&#34;VM vApp: &#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Host</span> <span class="n">-ForegroundColor</span> <span class="n">White</span> <span class="nv">$VAppName</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Host</span> <span class="n">-ForegroundColor</span> <span class="n">Yellow</span> <span class="s2">&#34;</span><span class="se">`n</span><span class="s2">---- Cloud Builder Configuration ----&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Host</span> <span class="n">-NoNewline</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span> <span class="s2">&#34;Hostname: &#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Host</span> <span class="n">-ForegroundColor</span> <span class="n">White</span> <span class="nv">$CloudbuilderVMHostname</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Host</span> <span class="n">-NoNewline</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span> <span class="s2">&#34;IP Address: &#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Host</span> <span class="n">-ForegroundColor</span> <span class="n">White</span> <span class="nv">$CloudbuilderIP</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nv">$deployNestedESXiVMsForMgmt</span> <span class="o">-eq</span> <span class="mf">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nb">Write-Host</span> <span class="n">-ForegroundColor</span> <span class="n">Yellow</span> <span class="s2">&#34;</span><span class="se">`n</span><span class="s2">---- vESXi Configuration for VCF Management Domain ----&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">Write-Host</span> <span class="n">-NoNewline</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span> <span class="s2">&#34;# of Nested ESXi VMs: &#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">Write-Host</span> <span class="n">-ForegroundColor</span> <span class="n">White</span> <span class="nv">$NestedESXiHostnameToIPsForManagementDomain</span><span class="p">.</span><span class="py">count</span>
</span></span><span class="line"><span class="cl">        <span class="nb">Write-Host</span> <span class="n">-NoNewline</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span> <span class="s2">&#34;IP Address(s): &#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">Write-Host</span> <span class="n">-ForegroundColor</span> <span class="n">White</span> <span class="nv">$NestedESXiHostnameToIPsForManagementDomain</span><span class="p">.</span><span class="py">Values</span>
</span></span><span class="line"><span class="cl">        <span class="nb">Write-Host</span> <span class="n">-NoNewline</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span> <span class="s2">&#34;vCPU: &#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">Write-Host</span> <span class="n">-ForegroundColor</span> <span class="n">White</span> <span class="nv">$NestedESXiMGMTvCPU</span>
</span></span><span class="line"><span class="cl">        <span class="nb">Write-Host</span> <span class="n">-NoNewline</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span> <span class="s2">&#34;vMEM: &#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">Write-Host</span> <span class="n">-ForegroundColor</span> <span class="n">White</span> <span class="s2">&#34;</span><span class="nv">$NestedESXiMGMTvMEM</span><span class="s2"> GB&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">Write-Host</span> <span class="n">-NoNewline</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span> <span class="s2">&#34;Caching VMDK: &#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">Write-Host</span> <span class="n">-ForegroundColor</span> <span class="n">White</span> <span class="s2">&#34;</span><span class="nv">$NestedESXiMGMTCachingvDisk</span><span class="s2"> GB&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">Write-Host</span> <span class="n">-NoNewline</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span> <span class="s2">&#34;Capacity VMDK: &#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">Write-Host</span> <span class="n">-ForegroundColor</span> <span class="n">White</span> <span class="s2">&#34;</span><span class="nv">$NestedESXiMGMTCapacityvDisk</span><span class="s2"> GB&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="c"># End If</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nv">$deployNestedESXiVMsForWLD</span> <span class="o">-eq</span> <span class="mf">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nb">Write-Host</span> <span class="n">-ForegroundColor</span> <span class="n">Yellow</span> <span class="s2">&#34;</span><span class="se">`n</span><span class="s2">---- vESXi Configuration for VCF Workload Domain ----&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">Write-Host</span> <span class="n">-NoNewline</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span> <span class="s2">&#34;# of Nested ESXi VMs: &#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">Write-Host</span> <span class="n">-ForegroundColor</span> <span class="n">White</span> <span class="nv">$NestedESXiHostnameToIPsForWorkloadDomain</span><span class="p">.</span><span class="py">count</span>
</span></span><span class="line"><span class="cl">        <span class="nb">Write-Host</span> <span class="n">-NoNewline</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span> <span class="s2">&#34;IP Address(s): &#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">Write-Host</span> <span class="n">-ForegroundColor</span> <span class="n">White</span> <span class="nv">$NestedESXiHostnameToIPsForWorkloadDomain</span><span class="p">.</span><span class="py">Values</span>
</span></span><span class="line"><span class="cl">        <span class="nb">Write-Host</span> <span class="n">-NoNewline</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span> <span class="s2">&#34;vCPU: &#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">Write-Host</span> <span class="n">-ForegroundColor</span> <span class="n">White</span> <span class="nv">$NestedESXiWLDvCPU</span>
</span></span><span class="line"><span class="cl">        <span class="nb">Write-Host</span> <span class="n">-NoNewline</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span> <span class="s2">&#34;vMEM: &#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">Write-Host</span> <span class="n">-ForegroundColor</span> <span class="n">White</span> <span class="s2">&#34;</span><span class="nv">$NestedESXiWLDvMEM</span><span class="s2"> GB&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">Write-Host</span> <span class="n">-NoNewline</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span> <span class="s2">&#34;Caching VMDK: &#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">Write-Host</span> <span class="n">-ForegroundColor</span> <span class="n">White</span> <span class="s2">&#34;</span><span class="nv">$NestedESXiWLDCachingvDisk</span><span class="s2"> GB&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">Write-Host</span> <span class="n">-NoNewline</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span> <span class="s2">&#34;Capacity VMDK: &#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">Write-Host</span> <span class="n">-ForegroundColor</span> <span class="n">White</span> <span class="s2">&#34;</span><span class="nv">$NestedESXiWLDCapacityvDisk</span><span class="s2"> GB&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="c"># End If</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Host</span> <span class="n">-NoNewline</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span> <span class="s2">&#34;</span><span class="se">`n</span><span class="s2">Netmask &#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Host</span> <span class="n">-ForegroundColor</span> <span class="n">White</span> <span class="nv">$VMNetmask</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Host</span> <span class="n">-NoNewline</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span> <span class="s2">&#34;Gateway: &#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Host</span> <span class="n">-ForegroundColor</span> <span class="n">White</span> <span class="nv">$VMGateway</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Host</span> <span class="n">-NoNewline</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span> <span class="s2">&#34;DNS: &#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Host</span> <span class="n">-ForegroundColor</span> <span class="n">White</span> <span class="nv">$VMDNS</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Host</span> <span class="n">-NoNewline</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span> <span class="s2">&#34;NTP: &#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Host</span> <span class="n">-ForegroundColor</span> <span class="n">White</span> <span class="nv">$VMNTP</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Host</span> <span class="n">-NoNewline</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span> <span class="s2">&#34;Syslog: &#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Host</span> <span class="n">-ForegroundColor</span> <span class="n">White</span> <span class="nv">$VMSyslog</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="c"># End If</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nv">$deployNestedESXiVMsForMgmt</span> <span class="o">-eq</span> <span class="mf">1</span> <span class="o">-or</span> <span class="nv">$deployNestedESXiVMsForWLD</span> <span class="o">-eq</span> <span class="mf">1</span> <span class="o">-or</span> <span class="nv">$deployCloudBuilder</span> <span class="o">-eq</span> <span class="mf">1</span> <span class="o">-or</span> <span class="nv">$moveVMsIntovApp</span> <span class="o">-eq</span> <span class="mf">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">New-LogEvent</span> <span class="s2">&#34;Connecting to Management vCenter Server </span><span class="nv">$VIServer</span><span class="s2"> ...&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$viConnection</span> <span class="p">=</span> <span class="nb">Connect-VIServer</span> <span class="nv">$VIServer</span> <span class="n">-User</span> <span class="nv">$VIUsername</span> <span class="n">-Password</span> <span class="nv">$VIPassword</span> <span class="n">-WarningAction</span> <span class="n">SilentlyContinue</span> <span class="n">-Protocol</span> <span class="n">https</span> <span class="n">-Force</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">$datastore</span> <span class="p">=</span> <span class="nb">Get-Datastore</span> <span class="n">-Server</span> <span class="nv">$viConnection</span> <span class="n">-Name</span> <span class="nv">$VMDatastore</span> <span class="p">|</span> <span class="nb">Select </span><span class="n">-First</span> <span class="mf">1</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$cluster</span> <span class="p">=</span> <span class="nb">Get-Cluster</span> <span class="n">-Server</span> <span class="nv">$viConnection</span> <span class="n">-Name</span> <span class="nv">$VMCluster</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$vmhost</span> <span class="p">=</span> <span class="nv">$cluster</span> <span class="p">|</span> <span class="nb">Get-VMHost</span> <span class="p">|</span> <span class="nb">Get-Random</span> <span class="n">-Count</span> <span class="mf">1</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="c"># End if</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Start Create Cloud Builder VM</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nv">$deployCloudBuilder</span> <span class="o">-eq</span> <span class="mf">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$ovfconfig</span> <span class="p">=</span> <span class="nb">Get-OvfConfiguration</span> <span class="nv">$CloudBuilderOVA</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">$networkMapLabel</span> <span class="p">=</span> <span class="p">(</span><span class="nv">$ovfconfig</span><span class="p">.</span><span class="py">ToHashTable</span><span class="p">().</span><span class="py">keys</span> <span class="p">|</span> <span class="nb">where </span><span class="p">{</span><span class="nv">$_</span> <span class="o">-Match</span> <span class="s2">&#34;NetworkMapping&#34;</span><span class="p">}).</span><span class="py">replace</span><span class="p">(</span><span class="s2">&#34;NetworkMapping.&#34;</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">).</span><span class="py">replace</span><span class="p">(</span><span class="s2">&#34;-&#34;</span><span class="p">,</span><span class="s2">&#34;_&#34;</span><span class="p">).</span><span class="py">replace</span><span class="p">(</span><span class="s2">&#34; &#34;</span><span class="p">,</span><span class="s2">&#34;_&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$ovfconfig</span><span class="p">.</span><span class="py">NetworkMapping</span><span class="p">.</span><span class="nv">$networkMapLabel</span><span class="p">.</span><span class="py">value</span> <span class="p">=</span> <span class="nv">$VMNetwork</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$ovfconfig</span><span class="p">.</span><span class="py">common</span><span class="p">.</span><span class="py">guestinfo</span><span class="p">.</span><span class="py">hostname</span><span class="p">.</span><span class="py">value</span> <span class="p">=</span> <span class="nv">$CloudbuilderFQDN</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$ovfconfig</span><span class="p">.</span><span class="py">common</span><span class="p">.</span><span class="py">guestinfo</span><span class="p">.</span><span class="py">ip0</span><span class="p">.</span><span class="py">value</span> <span class="p">=</span> <span class="nv">$CloudbuilderIP</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$ovfconfig</span><span class="p">.</span><span class="py">common</span><span class="p">.</span><span class="py">guestinfo</span><span class="p">.</span><span class="py">netmask0</span><span class="p">.</span><span class="py">value</span> <span class="p">=</span> <span class="nv">$VMNetmask</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$ovfconfig</span><span class="p">.</span><span class="py">common</span><span class="p">.</span><span class="py">guestinfo</span><span class="p">.</span><span class="py">gateway</span><span class="p">.</span><span class="py">value</span> <span class="p">=</span> <span class="nv">$VMGateway</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$ovfconfig</span><span class="p">.</span><span class="py">common</span><span class="p">.</span><span class="py">guestinfo</span><span class="p">.</span><span class="py">DNS</span><span class="p">.</span><span class="py">value</span> <span class="p">=</span> <span class="nv">$VMDNS</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$ovfconfig</span><span class="p">.</span><span class="py">common</span><span class="p">.</span><span class="py">guestinfo</span><span class="p">.</span><span class="py">domain</span><span class="p">.</span><span class="py">value</span> <span class="p">=</span> <span class="nv">$VMDomain</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$ovfconfig</span><span class="p">.</span><span class="py">common</span><span class="p">.</span><span class="py">guestinfo</span><span class="p">.</span><span class="py">searchpath</span><span class="p">.</span><span class="py">value</span> <span class="p">=</span> <span class="nv">$VMDomain</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$ovfconfig</span><span class="p">.</span><span class="py">common</span><span class="p">.</span><span class="py">guestinfo</span><span class="p">.</span><span class="py">ntp</span><span class="p">.</span><span class="py">value</span> <span class="p">=</span> <span class="nv">$VMNTP</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$ovfconfig</span><span class="p">.</span><span class="py">common</span><span class="p">.</span><span class="py">guestinfo</span><span class="p">.</span><span class="py">ADMIN_USERNAME</span><span class="p">.</span><span class="py">value</span> <span class="p">=</span> <span class="nv">$CloudbuilderAdminUsername</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$ovfconfig</span><span class="p">.</span><span class="py">common</span><span class="p">.</span><span class="py">guestinfo</span><span class="p">.</span><span class="py">ADMIN_PASSWORD</span><span class="p">.</span><span class="py">value</span> <span class="p">=</span> <span class="nv">$CloudbuilderAdminPassword</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$ovfconfig</span><span class="p">.</span><span class="py">common</span><span class="p">.</span><span class="py">guestinfo</span><span class="p">.</span><span class="py">ROOT_PASSWORD</span><span class="p">.</span><span class="py">value</span> <span class="p">=</span> <span class="nv">$CloudbuilderRootPassword</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">New-LogEvent</span> <span class="s2">&#34;Deploying Cloud Builder VM </span><span class="nv">$CloudbuilderVMHostname</span><span class="s2"> ...&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$vm</span> <span class="p">=</span> <span class="nb">Import-VApp</span> <span class="n">-Source</span> <span class="nv">$CloudBuilderOVA</span> <span class="n">-OvfConfiguration</span> <span class="nv">$ovfconfig</span> <span class="n">-Name</span> <span class="nv">$CloudbuilderVMHostname</span> <span class="n">-Location</span> <span class="nv">$VMCluster</span> <span class="n">-VMHost</span> <span class="nv">$vmhost</span> <span class="n">-Datastore</span> <span class="nv">$datastore</span> <span class="n">-DiskStorageFormat</span> <span class="n">thin</span> <span class="n">-Force</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">New-LogEvent</span> <span class="s2">&#34;Powering On </span><span class="nv">$CloudbuilderVMHostname</span><span class="s2"> ...&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$vm</span> <span class="p">|</span> <span class="nb">Start-Vm</span> <span class="n">-RunAsync</span> <span class="p">|</span> <span class="nb">Out-Null</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Move VMs into vApp. Keeps all the VCF VMs together.</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nv">$moveVMsIntovApp</span> <span class="o">-eq</span> <span class="mf">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c"># Check whether DRS is enabled as that is required to create vApp</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">((</span><span class="nb">Get-Cluster</span> <span class="n">-Server</span> <span class="nv">$viConnection</span> <span class="nv">$cluster</span><span class="p">).</span><span class="n">DrsEnabled</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nb">New-LogEvent</span> <span class="s2">&#34;Creating vApp </span><span class="nv">$VAppName</span><span class="s2"> ...&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$rp</span> <span class="p">=</span> <span class="nb">Get-ResourcePool</span> <span class="n">-Name</span> <span class="n">Resources</span> <span class="n">-Location</span> <span class="nv">$cluster</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$VApp</span> <span class="p">=</span> <span class="nb">New-VApp</span> <span class="n">-Name</span> <span class="nv">$VAppName</span> <span class="n">-Server</span> <span class="nv">$viConnection</span> <span class="n">-Location</span> <span class="nv">$cluster</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="o">-Not</span> <span class="p">(</span><span class="nb">Get-Folder</span> <span class="nv">$VMFolder</span> <span class="n">-ErrorAction</span> <span class="n">Ignore</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nb">New-LogEvent</span> <span class="s2">&#34;Creating VM Folder </span><span class="nv">$VMFolder</span><span class="s2"> ...&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$folder</span> <span class="p">=</span> <span class="nb">New-Folder</span> <span class="n">-Name</span> <span class="nv">$VMFolder</span> <span class="n">-Server</span> <span class="nv">$viConnection</span> <span class="n">-Location</span> <span class="p">(</span><span class="nb">Get-Datacenter</span> <span class="nv">$VMDatacenter</span> <span class="p">|</span> <span class="nb">Get-Folder</span> <span class="n">vm</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nv">$deployNestedESXiVMsForMgmt</span> <span class="o">-eq</span> <span class="mf">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nb">New-LogEvent</span> <span class="s2">&#34;Moving Nested ESXi VMs into </span><span class="nv">$VAppName</span><span class="s2"> vApp ...&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$NestedESXiHostnameToIPsForManagementDomain</span><span class="p">.</span><span class="py">GetEnumerator</span><span class="p">()</span> <span class="p">|</span> <span class="nb">Sort-Object</span> <span class="n">-Property</span> <span class="n">Value</span> <span class="p">|</span> <span class="nb">Foreach-Object</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$vm</span> <span class="p">=</span> <span class="nb">Get-VM</span> <span class="n">-Name</span> <span class="nv">$_</span><span class="p">.</span><span class="py">Key</span> <span class="n">-Server</span> <span class="nv">$viConnection</span> <span class="n">-Location</span> <span class="nv">$cluster</span> <span class="p">|</span> <span class="n">where</span><span class="p">{</span><span class="nv">$_</span><span class="p">.</span><span class="py">ResourcePool</span><span class="p">.</span><span class="py">Id</span> <span class="o">-eq</span> <span class="nv">$rp</span><span class="p">.</span><span class="n">Id</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="nb">Move-VM</span> <span class="n">-VM</span> <span class="nv">$vm</span> <span class="n">-Server</span> <span class="nv">$viConnection</span> <span class="n">-Destination</span> <span class="nv">$VApp</span> <span class="n">-Confirm:</span><span class="vm">$false</span> <span class="p">|</span> <span class="nb">Out-File</span> <span class="n">-Append</span> <span class="n">-LiteralPath</span> <span class="nv">$verboseLogFile</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nv">$deployNestedESXiVMsForWLD</span> <span class="o">-eq</span> <span class="mf">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nb">New-LogEvent</span> <span class="s2">&#34;Moving Nested ESXi VMs into </span><span class="nv">$VAppName</span><span class="s2"> vApp ...&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$NestedESXiHostnameToIPsForWorkloadDomain</span><span class="p">.</span><span class="py">GetEnumerator</span><span class="p">()</span> <span class="p">|</span> <span class="nb">Sort-Object</span> <span class="n">-Property</span> <span class="n">Value</span> <span class="p">|</span> <span class="nb">Foreach-Object</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$vm</span> <span class="p">=</span> <span class="nb">Get-VM</span> <span class="n">-Name</span> <span class="nv">$_</span><span class="p">.</span><span class="py">Key</span> <span class="n">-Server</span> <span class="nv">$viConnection</span> <span class="n">-Location</span> <span class="nv">$cluster</span> <span class="p">|</span> <span class="n">where</span><span class="p">{</span><span class="nv">$_</span><span class="p">.</span><span class="py">ResourcePool</span><span class="p">.</span><span class="py">Id</span> <span class="o">-eq</span> <span class="nv">$rp</span><span class="p">.</span><span class="n">Id</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="nb">Move-VM</span> <span class="n">-VM</span> <span class="nv">$vm</span> <span class="n">-Server</span> <span class="nv">$viConnection</span> <span class="n">-Destination</span> <span class="nv">$VApp</span> <span class="n">-Confirm:</span><span class="vm">$false</span> <span class="p">|</span> <span class="nb">Out-File</span> <span class="n">-Append</span> <span class="n">-LiteralPath</span> <span class="nv">$verboseLogFile</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nv">$deployCloudBuilder</span> <span class="o">-eq</span> <span class="mf">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$cloudBuilderVM</span> <span class="p">=</span> <span class="nb">Get-VM</span> <span class="n">-Name</span> <span class="nv">$CloudbuilderVMHostname</span> <span class="n">-Server</span> <span class="nv">$viConnection</span> <span class="n">-Location</span> <span class="nv">$cluster</span> <span class="p">|</span> <span class="n">where</span><span class="p">{</span><span class="nv">$_</span><span class="p">.</span><span class="py">ResourcePool</span><span class="p">.</span><span class="py">Id</span> <span class="o">-eq</span> <span class="nv">$rp</span><span class="p">.</span><span class="n">Id</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="nb">New-LogEvent</span> <span class="s2">&#34;Moving </span><span class="nv">$CloudbuilderVMHostname</span><span class="s2"> into </span><span class="nv">$VAppName</span><span class="s2"> vApp ...&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="nb">Move-VM</span> <span class="n">-VM</span> <span class="nv">$cloudBuilderVM</span> <span class="n">-Server</span> <span class="nv">$viConnection</span> <span class="n">-Destination</span> <span class="nv">$VApp</span> <span class="n">-Confirm:</span><span class="vm">$false</span> <span class="p">|</span> <span class="nb">Out-File</span> <span class="n">-Append</span> <span class="n">-LiteralPath</span> <span class="nv">$verboseLogFile</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nb">New-LogEvent</span> <span class="s2">&#34;Moving </span><span class="nv">$VAppName</span><span class="s2"> to VM Folder </span><span class="nv">$VMFolder</span><span class="s2"> ...&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">Move-VApp</span> <span class="n">-Server</span> <span class="nv">$viConnection</span> <span class="nv">$VAppName</span> <span class="n">-Destination</span> <span class="p">(</span><span class="nb">Get-Folder</span> <span class="n">-Server</span> <span class="nv">$viConnection</span> <span class="nv">$VMFolder</span><span class="p">)</span> <span class="p">|</span> <span class="nb">Out-File</span> <span class="n">-Append</span> <span class="n">-LiteralPath</span> <span class="nv">$verboseLogFile</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nb">New-LogEvent</span> <span class="s2">&#34;vApp </span><span class="nv">$VAppName</span><span class="s2"> will NOT be created as DRS is NOT enabled on vSphere Cluster </span><span class="nv">${cluster}</span><span class="s2"> ...&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Create Cloud Builder json file used to deploy VCF</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nv">$generateMgmJson</span> <span class="o">-eq</span> <span class="mf">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nv">$SeparateNSXSwitch</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$useNSX</span> <span class="p">=</span> <span class="s2">&#34;false&#34;</span> <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="nv">$useNSX</span> <span class="p">=</span> <span class="s2">&#34;true&#34;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">$esxivMotionNetwork</span> <span class="p">=</span> <span class="nv">$NestedESXivMotionNetworkCidr</span><span class="p">.</span><span class="py">split</span><span class="p">(</span><span class="s2">&#34;/&#34;</span><span class="p">)[</span><span class="mf">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$esxivMotionNetworkOctects</span> <span class="p">=</span> <span class="nv">$esxivMotionNetwork</span><span class="p">.</span><span class="py">split</span><span class="p">(</span><span class="s2">&#34;.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$esxivMotionGateway</span> <span class="p">=</span> <span class="p">(</span><span class="nv">$esxivMotionNetworkOctects</span><span class="p">[</span><span class="mf">0</span><span class="p">.</span><span class="mf">.2</span><span class="p">]</span> <span class="n">-join</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="p">+</span> <span class="s2">&#34;.1&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$esxivMotionStart</span> <span class="p">=</span> <span class="p">(</span><span class="nv">$esxivMotionNetworkOctects</span><span class="p">[</span><span class="mf">0</span><span class="p">.</span><span class="mf">.2</span><span class="p">]</span> <span class="n">-join</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="p">+</span> <span class="s2">&#34;.101&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$esxivMotionEnd</span> <span class="p">=</span> <span class="p">(</span><span class="nv">$esxivMotionNetworkOctects</span><span class="p">[</span><span class="mf">0</span><span class="p">.</span><span class="mf">.2</span><span class="p">]</span> <span class="n">-join</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="p">+</span> <span class="s2">&#34;.118&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">$esxivSANNetwork</span> <span class="p">=</span> <span class="nv">$NestedESXivSANNetworkCidr</span><span class="p">.</span><span class="py">split</span><span class="p">(</span><span class="s2">&#34;/&#34;</span><span class="p">)[</span><span class="mf">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$esxivSANNetworkOctects</span> <span class="p">=</span> <span class="nv">$esxivSANNetwork</span><span class="p">.</span><span class="py">split</span><span class="p">(</span><span class="s2">&#34;.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$esxivSANGateway</span> <span class="p">=</span> <span class="p">(</span><span class="nv">$esxivSANNetworkOctects</span><span class="p">[</span><span class="mf">0</span><span class="p">.</span><span class="mf">.2</span><span class="p">]</span> <span class="n">-join</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="p">+</span> <span class="s2">&#34;.1&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$esxivSANStart</span> <span class="p">=</span> <span class="p">(</span><span class="nv">$esxivSANNetworkOctects</span><span class="p">[</span><span class="mf">0</span><span class="p">.</span><span class="mf">.2</span><span class="p">]</span> <span class="n">-join</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="p">+</span> <span class="s2">&#34;.101&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$esxivSANEnd</span> <span class="p">=</span> <span class="p">(</span><span class="nv">$esxivSANNetworkOctects</span><span class="p">[</span><span class="mf">0</span><span class="p">.</span><span class="mf">.2</span><span class="p">]</span> <span class="n">-join</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="p">+</span> <span class="s2">&#34;.118&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">$esxiNSXTepNetwork</span> <span class="p">=</span> <span class="nv">$NestedESXiNSXTepNetworkCidr</span><span class="p">.</span><span class="py">split</span><span class="p">(</span><span class="s2">&#34;/&#34;</span><span class="p">)[</span><span class="mf">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$esxiNSXTepNetworkOctects</span> <span class="p">=</span> <span class="nv">$esxiNSXTepNetwork</span><span class="p">.</span><span class="py">split</span><span class="p">(</span><span class="s2">&#34;.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$esxiNSXTepGateway</span> <span class="p">=</span> <span class="p">(</span><span class="nv">$esxiNSXTepNetworkOctects</span><span class="p">[</span><span class="mf">0</span><span class="p">.</span><span class="mf">.2</span><span class="p">]</span> <span class="n">-join</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="p">+</span> <span class="s2">&#34;.1&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$esxiNSXTepStart</span> <span class="p">=</span> <span class="p">(</span><span class="nv">$esxiNSXTepNetworkOctects</span><span class="p">[</span><span class="mf">0</span><span class="p">.</span><span class="mf">.2</span><span class="p">]</span> <span class="n">-join</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="p">+</span> <span class="s2">&#34;.101&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$esxiNSXTepEnd</span> <span class="p">=</span> <span class="p">(</span><span class="nv">$esxiNSXTepNetworkOctects</span><span class="p">[</span><span class="mf">0</span><span class="p">.</span><span class="mf">.2</span><span class="p">]</span> <span class="n">-join</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="p">+</span> <span class="s2">&#34;.118&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">$hostSpecs</span> <span class="p">=</span> <span class="vm">@</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$count</span> <span class="p">=</span> <span class="mf">1</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$NestedESXiHostnameToIPsForManagementDomain</span><span class="p">.</span><span class="py">GetEnumerator</span><span class="p">()</span> <span class="p">|</span> <span class="nb">Sort-Object</span> <span class="n">-Property</span> <span class="n">Value</span> <span class="p">|</span> <span class="nb">Foreach-Object</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$VMName</span> <span class="p">=</span> <span class="nv">$_</span><span class="p">.</span><span class="py">Key</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$VMIPAddress</span> <span class="p">=</span> <span class="nv">$_</span><span class="p">.</span><span class="py">Value</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nv">$hostSpec</span> <span class="p">=</span> <span class="p">[</span><span class="no">ordered</span><span class="p">]</span><span class="vm">@</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;association&#34;</span> <span class="p">=</span> <span class="s2">&#34;vcf-m01-dc01&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;ipAddressPrivate&#34;</span> <span class="p">=</span> <span class="p">[</span><span class="no">ordered</span><span class="p">]</span><span class="vm">@</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;ipAddress&#34;</span> <span class="p">=</span> <span class="nv">$VMIPAddress</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;cidr&#34;</span> <span class="p">=</span> <span class="nv">$NestedESXiManagementNetworkCidr</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;gateway&#34;</span> <span class="p">=</span> <span class="nv">$VMGateway</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;hostname&#34;</span> <span class="p">=</span> <span class="nv">$VMName</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;credentials&#34;</span> <span class="p">=</span> <span class="p">[</span><span class="no">ordered</span><span class="p">]</span><span class="vm">@</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;username&#34;</span> <span class="p">=</span> <span class="s2">&#34;root&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;password&#34;</span> <span class="p">=</span> <span class="nv">$VMPassword</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;sshThumbprint&#34;</span> <span class="p">=</span> <span class="s2">&#34;SHA256:DUMMY_VALUE&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;sslThumbprint&#34;</span> <span class="p">=</span> <span class="s2">&#34;SHA25_DUMMY_VALUE&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;vSwitch&#34;</span> <span class="p">=</span> <span class="s2">&#34;vSwitch0&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;serverId&#34;</span> <span class="p">=</span> <span class="s2">&#34;host-</span><span class="nv">$count</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$hostSpecs</span><span class="p">+=</span><span class="nv">$hostSpec</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$count</span><span class="p">++</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">$vcfConfig</span> <span class="p">=</span> <span class="p">[</span><span class="no">ordered</span><span class="p">]</span><span class="vm">@</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;subscriptionLicensing&#34;</span> <span class="p">=</span> <span class="vm">$false</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;skipEsxThumbprintValidation&#34;</span> <span class="p">=</span> <span class="vm">$true</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;managementPoolName&#34;</span> <span class="p">=</span> <span class="nv">$VCFManagementDomainPoolName</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;sddcId&#34;</span> <span class="p">=</span> <span class="s2">&#34;vcf-m01&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;taskName&#34;</span> <span class="p">=</span> <span class="s2">&#34;workflowconfig/workflowspec-ems.json&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;esxLicense&#34;</span> <span class="p">=</span> <span class="s2">&#34;</span><span class="nv">$ESXILicense</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;ceipEnabled&#34;</span> <span class="p">=</span> <span class="vm">$true</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;ntpServers&#34;</span> <span class="p">=</span> <span class="vm">@</span><span class="p">(</span><span class="nv">$VMNTP</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;dnsSpec&#34;</span> <span class="p">=</span> <span class="p">[</span><span class="no">ordered</span><span class="p">]</span><span class="vm">@</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;subdomain&#34;</span> <span class="p">=</span> <span class="nv">$VMDomain</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;domain&#34;</span> <span class="p">=</span> <span class="nv">$VMDomain</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;nameserver&#34;</span> <span class="p">=</span> <span class="nv">$VMDNS</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;sddcManagerSpec&#34;</span> <span class="p">=</span> <span class="p">[</span><span class="no">ordered</span><span class="p">]</span><span class="vm">@</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;ipAddress&#34;</span> <span class="p">=</span> <span class="nv">$SddcManagerIP</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;netmask&#34;</span> <span class="p">=</span> <span class="nv">$VMNetmask</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;hostname&#34;</span> <span class="p">=</span> <span class="nv">$SddcManagerHostname</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;localUserPassword&#34;</span> <span class="p">=</span> <span class="s2">&#34;</span><span class="nv">$SddcManagerLocalPassword</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;vcenterId&#34;</span> <span class="p">=</span> <span class="s2">&#34;vcenter-1&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;secondUserCredentials&#34;</span> <span class="p">=</span> <span class="p">[</span><span class="no">ordered</span><span class="p">]</span><span class="vm">@</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;username&#34;</span> <span class="p">=</span> <span class="s2">&#34;vcf&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;password&#34;</span> <span class="p">=</span> <span class="nv">$SddcManagerVcfPassword</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;rootUserCredentials&#34;</span> <span class="p">=</span> <span class="p">[</span><span class="no">ordered</span><span class="p">]</span><span class="vm">@</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;username&#34;</span> <span class="p">=</span> <span class="s2">&#34;root&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;password&#34;</span> <span class="p">=</span> <span class="nv">$SddcManagerRootPassword</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;restApiCredentials&#34;</span> <span class="p">=</span> <span class="p">[</span><span class="no">ordered</span><span class="p">]</span><span class="vm">@</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;username&#34;</span> <span class="p">=</span> <span class="s2">&#34;admin&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;password&#34;</span> <span class="p">=</span> <span class="nv">$SddcManagerRestPassword</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;networkSpecs&#34;</span> <span class="p">=</span> <span class="vm">@</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="p">[</span><span class="no">ordered</span><span class="p">]</span><span class="vm">@</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;networkType&#34;</span> <span class="p">=</span> <span class="s2">&#34;MANAGEMENT&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;subnet&#34;</span> <span class="p">=</span> <span class="nv">$NestedESXiManagementNetworkCidr</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;gateway&#34;</span> <span class="p">=</span> <span class="nv">$VMGateway</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;vlanId&#34;</span> <span class="p">=</span> <span class="s2">&#34;0&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;mtu&#34;</span> <span class="p">=</span> <span class="s2">&#34;1500&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;portGroupKey&#34;</span> <span class="p">=</span> <span class="s2">&#34;vcf-m01-cl01-vds01-pg-mgmt&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;standbyUplinks&#34;</span> <span class="p">=</span> <span class="vm">@</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;activeUplinks&#34;</span> <span class="p">=</span> <span class="vm">@</span><span class="p">(</span><span class="s2">&#34;uplink1&#34;</span><span class="p">,</span><span class="s2">&#34;uplink2&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">[</span><span class="no">ordered</span><span class="p">]</span><span class="vm">@</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;networkType&#34;</span> <span class="p">=</span> <span class="s2">&#34;VMOTION&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;subnet&#34;</span> <span class="p">=</span> <span class="nv">$NestedESXivMotionNetworkCidr</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;gateway&#34;</span> <span class="p">=</span> <span class="nv">$esxivMotionGateway</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;vlanId&#34;</span> <span class="p">=</span> <span class="s2">&#34;0&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;mtu&#34;</span> <span class="p">=</span> <span class="s2">&#34;9000&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;portGroupKey&#34;</span> <span class="p">=</span> <span class="s2">&#34;vcf-m01-cl01-vds01-pg-vmotion&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;association&#34;</span> <span class="p">=</span> <span class="s2">&#34;vcf-m01-dc01&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;includeIpAddressRanges&#34;</span> <span class="p">=</span> <span class="vm">@</span><span class="p">(</span><span class="vm">@</span><span class="p">{</span><span class="s2">&#34;startIpAddress&#34;</span> <span class="p">=</span> <span class="nv">$esxivMotionStart</span><span class="p">;</span><span class="s2">&#34;endIpAddress&#34;</span> <span class="p">=</span> <span class="nv">$esxivMotionEnd</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;standbyUplinks&#34;</span> <span class="p">=</span> <span class="vm">@</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;activeUplinks&#34;</span> <span class="p">=</span> <span class="vm">@</span><span class="p">(</span><span class="s2">&#34;uplink1&#34;</span><span class="p">,</span><span class="s2">&#34;uplink2&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">[</span><span class="no">ordered</span><span class="p">]</span><span class="vm">@</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;networkType&#34;</span> <span class="p">=</span> <span class="s2">&#34;VSAN&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;subnet&#34;</span> <span class="p">=</span> <span class="nv">$NestedESXivSANNetworkCidr</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;gateway&#34;</span><span class="p">=</span> <span class="nv">$esxivSANGateway</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;vlanId&#34;</span> <span class="p">=</span> <span class="s2">&#34;0&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;mtu&#34;</span> <span class="p">=</span> <span class="s2">&#34;9000&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;portGroupKey&#34;</span> <span class="p">=</span> <span class="s2">&#34;vcf-m01-cl01-vds01-pg-vsan&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;includeIpAddressRanges&#34;</span> <span class="p">=</span> <span class="vm">@</span><span class="p">(</span><span class="vm">@</span><span class="p">{</span><span class="s2">&#34;startIpAddress&#34;</span> <span class="p">=</span> <span class="nv">$esxivSANStart</span><span class="p">;</span><span class="s2">&#34;endIpAddress&#34;</span> <span class="p">=</span> <span class="nv">$esxivSANEnd</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;standbyUplinks&#34;</span> <span class="p">=</span> <span class="vm">@</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;activeUplinks&#34;</span> <span class="p">=</span> <span class="vm">@</span><span class="p">(</span><span class="s2">&#34;uplink1&#34;</span><span class="p">,</span><span class="s2">&#34;uplink2&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;nsxtSpec&#34;</span> <span class="p">=</span> <span class="p">[</span><span class="no">ordered</span><span class="p">]</span><span class="vm">@</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;nsxtManagerSize&#34;</span> <span class="p">=</span> <span class="nv">$NSXManagerSize</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;nsxtManagers&#34;</span> <span class="p">=</span> <span class="vm">@</span><span class="p">(</span><span class="vm">@</span><span class="p">{</span><span class="s2">&#34;hostname&#34;</span> <span class="p">=</span> <span class="nv">$NSXManagerNode1Hostname</span><span class="p">;</span><span class="s2">&#34;ip&#34;</span> <span class="p">=</span> <span class="nv">$NSXManagerNode1IP</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;rootNsxtManagerPassword&#34;</span> <span class="p">=</span> <span class="nv">$NSXRootPassword</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;nsxtAdminPassword&#34;</span> <span class="p">=</span> <span class="nv">$NSXAdminPassword</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;nsxtAuditPassword&#34;</span> <span class="p">=</span> <span class="nv">$NSXAuditPassword</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;rootLoginEnabledForNsxtManager&#34;</span> <span class="p">=</span> <span class="vm">$true</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;sshEnabledForNsxtManager&#34;</span> <span class="p">=</span> <span class="vm">$true</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;overLayTransportZone&#34;</span> <span class="p">=</span> <span class="p">[</span><span class="no">ordered</span><span class="p">]</span><span class="vm">@</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;zoneName&#34;</span> <span class="p">=</span> <span class="s2">&#34;vcf-m01-tz-overlay01&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;networkName&#34;</span> <span class="p">=</span> <span class="s2">&#34;netName-overlay&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;vlanTransportZone&#34;</span> <span class="p">=</span> <span class="p">[</span><span class="no">ordered</span><span class="p">]</span><span class="vm">@</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;zoneName&#34;</span> <span class="p">=</span> <span class="s2">&#34;vcf-m01-tz-vlan01&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;networkName&#34;</span> <span class="p">=</span> <span class="s2">&#34;netName-vlan&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;vip&#34;</span> <span class="p">=</span> <span class="nv">$NSXManagerVIPIP</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;vipFqdn&#34;</span> <span class="p">=</span> <span class="nv">$NSXManagerVIPHostname</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;nsxtLicense&#34;</span> <span class="p">=</span> <span class="nv">$NSXLicense</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;transportVlanId&#34;</span> <span class="p">=</span> <span class="s2">&#34;2005&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;ipAddressPoolSpec&#34;</span> <span class="p">=</span> <span class="p">[</span><span class="no">ordered</span><span class="p">]</span><span class="vm">@</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;name&#34;</span> <span class="p">=</span> <span class="s2">&#34;vcf-m01-c101-tep01&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;description&#34;</span> <span class="p">=</span> <span class="s2">&#34;ESXi Host Overlay TEP IP Pool&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;subnets&#34;</span> <span class="p">=</span> <span class="vm">@</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                    <span class="vm">@</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="s2">&#34;ipAddressPoolRanges&#34;</span> <span class="p">=</span> <span class="vm">@</span><span class="p">(</span><span class="vm">@</span><span class="p">{</span><span class="s2">&#34;start&#34;</span> <span class="p">=</span> <span class="nv">$esxiNSXTepStart</span><span class="p">;</span><span class="s2">&#34;end&#34;</span> <span class="p">=</span> <span class="nv">$esxiNSXTepEnd</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">                        <span class="s2">&#34;cidr&#34;</span> <span class="p">=</span> <span class="nv">$NestedESXiNSXTepNetworkCidr</span>
</span></span><span class="line"><span class="cl">                        <span class="s2">&#34;gateway&#34;</span> <span class="p">=</span> <span class="nv">$esxiNSXTepGateway</span>
</span></span><span class="line"><span class="cl">                    <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;vsanSpec&#34;</span> <span class="p">=</span> <span class="p">[</span><span class="no">ordered</span><span class="p">]</span><span class="vm">@</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;vsanName&#34;</span> <span class="p">=</span> <span class="s2">&#34;vsan-1&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;vsanDedup&#34;</span> <span class="p">=</span> <span class="s2">&#34;false&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;licenseFile&#34;</span> <span class="p">=</span> <span class="nv">$VSANLicense</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;datastoreName&#34;</span> <span class="p">=</span> <span class="s2">&#34;vcf-m01-cl01-ds-vsan01&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;dvSwitchVersion&#34;</span> <span class="p">=</span> <span class="s2">&#34;7.0.0&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;dvsSpecs&#34;</span> <span class="p">=</span> <span class="vm">@</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="p">[</span><span class="no">ordered</span><span class="p">]</span><span class="vm">@</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;dvsName&#34;</span> <span class="p">=</span> <span class="s2">&#34;vcf-m01-cl01-vds01&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;vcenterId&#34;</span> <span class="p">=</span> <span class="s2">&#34;vcenter-1&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;vmnics&#34;</span> <span class="p">=</span> <span class="vm">@</span><span class="p">(</span><span class="s2">&#34;vmnic0&#34;</span><span class="p">,</span><span class="s2">&#34;vmnic1&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;mtu&#34;</span> <span class="p">=</span> <span class="s2">&#34;9000&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;networks&#34;</span> <span class="p">=</span> <span class="vm">@</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                    <span class="s2">&#34;MANAGEMENT&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="s2">&#34;VMOTION&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="s2">&#34;VSAN&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;niocSpecs&#34;</span> <span class="p">=</span> <span class="vm">@</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                    <span class="vm">@</span><span class="p">{</span><span class="s2">&#34;trafficType&#34;</span><span class="p">=</span><span class="s2">&#34;VSAN&#34;</span><span class="p">;</span><span class="s2">&#34;value&#34;</span><span class="p">=</span><span class="s2">&#34;HIGH&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">                    <span class="vm">@</span><span class="p">{</span><span class="s2">&#34;trafficType&#34;</span><span class="p">=</span><span class="s2">&#34;VMOTION&#34;</span><span class="p">;</span><span class="s2">&#34;value&#34;</span><span class="p">=</span><span class="s2">&#34;LOW&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">                    <span class="vm">@</span><span class="p">{</span><span class="s2">&#34;trafficType&#34;</span><span class="p">=</span><span class="s2">&#34;VDP&#34;</span><span class="p">;</span><span class="s2">&#34;value&#34;</span><span class="p">=</span><span class="s2">&#34;LOW&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">                    <span class="vm">@</span><span class="p">{</span><span class="s2">&#34;trafficType&#34;</span><span class="p">=</span><span class="s2">&#34;VIRTUALMACHINE&#34;</span><span class="p">;</span><span class="s2">&#34;value&#34;</span><span class="p">=</span><span class="s2">&#34;HIGH&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">                    <span class="vm">@</span><span class="p">{</span><span class="s2">&#34;trafficType&#34;</span><span class="p">=</span><span class="s2">&#34;MANAGEMENT&#34;</span><span class="p">;</span><span class="s2">&#34;value&#34;</span><span class="p">=</span><span class="s2">&#34;NORMAL&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">                    <span class="vm">@</span><span class="p">{</span><span class="s2">&#34;trafficType&#34;</span><span class="p">=</span><span class="s2">&#34;NFS&#34;</span><span class="p">;</span><span class="s2">&#34;value&#34;</span><span class="p">=</span><span class="s2">&#34;LOW&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">                    <span class="vm">@</span><span class="p">{</span><span class="s2">&#34;trafficType&#34;</span><span class="p">=</span><span class="s2">&#34;HBR&#34;</span><span class="p">;</span><span class="s2">&#34;value&#34;</span><span class="p">=</span><span class="s2">&#34;LOW&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">                    <span class="vm">@</span><span class="p">{</span><span class="s2">&#34;trafficType&#34;</span><span class="p">=</span><span class="s2">&#34;FAULTTOLERANCE&#34;</span><span class="p">;</span><span class="s2">&#34;value&#34;</span><span class="p">=</span><span class="s2">&#34;LOW&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">                    <span class="vm">@</span><span class="p">{</span><span class="s2">&#34;trafficType&#34;</span><span class="p">=</span><span class="s2">&#34;ISCSI&#34;</span><span class="p">;</span><span class="s2">&#34;value&#34;</span><span class="p">=</span><span class="s2">&#34;LOW&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;isUsedByNsxt&#34;</span> <span class="p">=</span> <span class="nv">$useNSX</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;clusterSpec&#34;</span> <span class="p">=</span> <span class="p">[</span><span class="no">ordered</span><span class="p">]</span><span class="vm">@</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;clusterName&#34;</span> <span class="p">=</span> <span class="s2">&#34;vcf-m01-cl01&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;vcenterName&#34;</span> <span class="p">=</span> <span class="s2">&#34;vcenter-1&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;clusterEvcMode&#34;</span> <span class="p">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;hostFailuresToTolerate&#34;</span> <span class="p">=</span> <span class="mf">0</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;vmFolders&#34;</span> <span class="p">=</span> <span class="p">[</span><span class="no">ordered</span><span class="p">]</span> <span class="vm">@</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;MANAGEMENT&#34;</span> <span class="p">=</span> <span class="s2">&#34;vcf-m01-fd-mgmt&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;NETWORKING&#34;</span> <span class="p">=</span> <span class="s2">&#34;vcf-m01-fd-nsx&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;EDGENODES&#34;</span> <span class="p">=</span> <span class="s2">&#34;vcf-m01-fd-edge&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;clusterImageEnabled&#34;</span> <span class="p">=</span> <span class="nv">$EnableVCLM</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;resourcePoolSpecs&#34;</span> <span class="p">=</span><span class="vm">@</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="p">[</span><span class="no">ordered</span><span class="p">]</span><span class="vm">@</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;name&#34;</span> <span class="p">=</span> <span class="s2">&#34;vcf-m01-cl01-rp-sddc-mgmt&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;type&#34;</span> <span class="p">=</span> <span class="s2">&#34;management&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;cpuReservationPercentage&#34;</span> <span class="p">=</span> <span class="mf">0</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;cpuLimit&#34;</span> <span class="p">=</span> <span class="mf">-1</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;cpuReservationExpandable&#34;</span> <span class="p">=</span> <span class="vm">$true</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;cpuSharesLevel&#34;</span> <span class="p">=</span> <span class="s2">&#34;normal&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;cpuSharesValue&#34;</span> <span class="p">=</span> <span class="mf">0</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;memoryReservationMb&#34;</span> <span class="p">=</span> <span class="mf">0</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;memoryLimit&#34;</span> <span class="p">=</span> <span class="mf">-1</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;memoryReservationExpandable&#34;</span> <span class="p">=</span> <span class="vm">$true</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;memorySharesLevel&#34;</span> <span class="p">=</span> <span class="s2">&#34;normal&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;memorySharesValue&#34;</span> <span class="p">=</span> <span class="mf">0</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">[</span><span class="no">ordered</span><span class="p">]</span><span class="vm">@</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;name&#34;</span> <span class="p">=</span> <span class="s2">&#34;vcf-m01-cl01-rp-sddc-edge&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;type&#34;</span> <span class="p">=</span> <span class="s2">&#34;network&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;cpuReservationPercentage&#34;</span> <span class="p">=</span> <span class="mf">0</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;cpuLimit&#34;</span> <span class="p">=</span> <span class="mf">-1</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;cpuReservationExpandable&#34;</span> <span class="p">=</span> <span class="vm">$true</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;cpuSharesLevel&#34;</span> <span class="p">=</span> <span class="s2">&#34;normal&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;cpuSharesValue&#34;</span> <span class="p">=</span> <span class="mf">0</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;memoryReservationPercentage&#34;</span> <span class="p">=</span> <span class="mf">0</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;memoryLimit&#34;</span> <span class="p">=</span> <span class="mf">-1</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;memoryReservationExpandable&#34;</span> <span class="p">=</span> <span class="vm">$true</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;memorySharesLevel&#34;</span> <span class="p">=</span> <span class="s2">&#34;normal&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;memorySharesValue&#34;</span> <span class="p">=</span> <span class="mf">0</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">[</span><span class="no">ordered</span><span class="p">]</span><span class="vm">@</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;name&#34;</span> <span class="p">=</span> <span class="s2">&#34;vcf-m01-cl01-rp-user-edge&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;type&#34;</span> <span class="p">=</span> <span class="s2">&#34;compute&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;cpuReservationPercentage&#34;</span> <span class="p">=</span> <span class="mf">0</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;cpuLimit&#34;</span> <span class="p">=</span> <span class="mf">-1</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;cpuReservationExpandable&#34;</span> <span class="p">=</span> <span class="vm">$true</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;cpuSharesLevel&#34;</span> <span class="p">=</span> <span class="s2">&#34;normal&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;cpuSharesValue&#34;</span> <span class="p">=</span> <span class="mf">0</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;memoryReservationPercentage&#34;</span> <span class="p">=</span> <span class="mf">0</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;memoryLimit&#34;</span> <span class="p">=</span> <span class="mf">-1</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;memoryReservationExpandable&#34;</span> <span class="p">=</span> <span class="vm">$true</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;memorySharesLevel&#34;</span> <span class="p">=</span> <span class="s2">&#34;normal&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;memorySharesValue&#34;</span> <span class="p">=</span> <span class="mf">0</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">[</span><span class="no">ordered</span><span class="p">]</span><span class="vm">@</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;name&#34;</span> <span class="p">=</span> <span class="s2">&#34;vcf-m01-cl01-rp-user-vm&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;type&#34;</span> <span class="p">=</span> <span class="s2">&#34;compute&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;cpuReservationPercentage&#34;</span> <span class="p">=</span> <span class="mf">0</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;cpuLimit&#34;</span> <span class="p">=</span> <span class="mf">-1</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;cpuReservationExpandable&#34;</span> <span class="p">=</span> <span class="vm">$true</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;cpuSharesLevel&#34;</span> <span class="p">=</span> <span class="s2">&#34;normal&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;cpuSharesValue&#34;</span> <span class="p">=</span> <span class="mf">0</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;memoryReservationPercentage&#34;</span> <span class="p">=</span> <span class="mf">0</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;memoryLimit&#34;</span> <span class="p">=</span> <span class="mf">-1</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;memoryReservationExpandable&#34;</span> <span class="p">=</span> <span class="vm">$true</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;memorySharesLevel&#34;</span> <span class="p">=</span> <span class="s2">&#34;normal&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;memorySharesValue&#34;</span> <span class="p">=</span> <span class="mf">0</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;pscSpecs&#34;</span> <span class="p">=</span> <span class="vm">@</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="p">[</span><span class="no">ordered</span><span class="p">]</span><span class="vm">@</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;pscId&#34;</span> <span class="p">=</span> <span class="s2">&#34;psc-1&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;vcenterId&#34;</span> <span class="p">=</span> <span class="s2">&#34;vcenter-1&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;adminUserSsoPassword&#34;</span> <span class="p">=</span> <span class="nv">$VCSASSOPassword</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;pscSsoSpec&#34;</span> <span class="p">=</span> <span class="vm">@</span><span class="p">{</span><span class="s2">&#34;ssoDomain&#34;</span><span class="p">=</span><span class="s2">&#34;vsphere.local&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;vcenterSpec&#34;</span> <span class="p">=</span> <span class="p">[</span><span class="no">ordered</span><span class="p">]</span><span class="vm">@</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;vcenterIp&#34;</span> <span class="p">=</span> <span class="nv">$VCSAIP</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;vcenterHostname&#34;</span> <span class="p">=</span> <span class="nv">$VCSAName</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;vcenterId&#34;</span> <span class="p">=</span> <span class="s2">&#34;vcenter-1&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;licenseFile&#34;</span> <span class="p">=</span> <span class="nv">$VCSALicense</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;vmSize&#34;</span> <span class="p">=</span> <span class="s2">&#34;tiny&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;storageSize&#34;</span> <span class="p">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;rootVcenterPassword&#34;</span> <span class="p">=</span> <span class="nv">$VCSARootPassword</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;hostSpecs&#34;</span> <span class="p">=</span> <span class="nv">$hostSpecs</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;excludedComponents&#34;</span> <span class="p">=</span> <span class="vm">@</span><span class="p">(</span><span class="s2">&#34;NSX-V&#34;</span><span class="p">,</span> <span class="s2">&#34;AVN&#34;</span><span class="p">,</span> <span class="s2">&#34;EBGP&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nv">$SeparateNSXSwitch</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$sepNsxSwitchSpec</span> <span class="p">=</span> <span class="p">[</span><span class="no">ordered</span><span class="p">]</span><span class="vm">@</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;dvsName&#34;</span> <span class="p">=</span> <span class="s2">&#34;vcf-m01-nsx-vds01&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;vcenterId&#34;</span> <span class="p">=</span> <span class="s2">&#34;vcenter-1&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;vmnics&#34;</span> <span class="p">=</span> <span class="vm">@</span><span class="p">(</span><span class="s2">&#34;vmnic2&#34;</span><span class="p">,</span><span class="s2">&#34;vmnic3&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;mtu&#34;</span> <span class="p">=</span> <span class="mf">9000</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;networks&#34;</span> <span class="p">=</span> <span class="vm">@</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;isUsedByNsxt&#34;</span> <span class="p">=</span> <span class="vm">$true</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$vcfConfig</span><span class="p">.</span><span class="n">dvsSpecs</span><span class="p">+=</span><span class="nv">$sepNsxSwitchSpec</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c"># License Later feature only applicable for VCF 5.1.1 and later</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nv">$VCFVersion</span> <span class="o">-ge</span> <span class="s2">&#34;5.1.1&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nv">$VCSALicense</span> <span class="o">-eq</span> <span class="s2">&#34;&#34;</span> <span class="o">-and</span> <span class="nv">$ESXILicense</span> <span class="o">-eq</span> <span class="s2">&#34;&#34;</span> <span class="o">-and</span> <span class="nv">$VSANLicense</span> <span class="o">-eq</span> <span class="s2">&#34;&#34;</span> <span class="o">-and</span> <span class="nv">$NSXLicense</span> <span class="o">-eq</span> <span class="s2">&#34;&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$EvaluationMode</span> <span class="p">=</span> <span class="vm">$true</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$EvaluationMode</span> <span class="p">=</span> <span class="vm">$false</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$vcfConfig</span><span class="p">.</span><span class="py">add</span><span class="p">(</span><span class="s2">&#34;deployWithoutLicenseKeys&#34;</span><span class="p">,</span><span class="nv">$EvaluationMode</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">New-LogEvent</span> <span class="s2">&#34;Generating Cloud Builder VCF Management Domain configuration deployment file </span><span class="nv">$VCFManagementDomainJSONFile</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$vcfConfig</span> <span class="p">|</span> <span class="nb">ConvertTo-Json</span> <span class="n">-Depth</span> <span class="mf">20</span> <span class="p">|</span> <span class="nb">Out-File</span> <span class="n">-LiteralPath</span> <span class="nv">$VCFManagementDomainJSONFile</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Make Config Change to Cloud Builder to work with only one Host</span>
</span></span><span class="line"><span class="cl"><span class="nv">$vm</span> <span class="p">=</span> <span class="nb">Get-VM</span> <span class="n">-Name</span> <span class="nv">$CloudbuilderVMHostname</span>
</span></span><span class="line"><span class="cl"><span class="nv">$o</span> <span class="p">=</span> <span class="nb">Invoke-VMScript</span> <span class="n">-VM</span> <span class="nv">$vm</span> <span class="n">-ScriptText</span> <span class="s1">&#39;echo &#34;bringup.mgmt.cluster.minimum.size=1&#34; &gt;&gt; /etc/vmware/vcf/bringup/application.properties&#39;</span> <span class="n">-GuestUser</span> <span class="s2">&#34;root&#34;</span> <span class="n">-GuestPassword</span> <span class="nv">$CloudbuilderRootPassword</span> <span class="n">-ScriptType</span> <span class="n">Bash</span>
</span></span><span class="line"><span class="cl"><span class="nv">$o</span> <span class="p">=</span> <span class="nb">Invoke-VMScript</span> <span class="n">-VM</span> <span class="nv">$vm</span> <span class="n">-ScriptText</span> <span class="s1">&#39;cat /etc/vmware/vcf/bringup/application.properties&#39;</span> <span class="n">-GuestUser</span> <span class="s2">&#34;root&#34;</span> <span class="n">-GuestPassword</span> <span class="nv">$CloudbuilderRootPassword</span> <span class="n">-ScriptType</span> <span class="n">Bash</span>
</span></span><span class="line"><span class="cl"><span class="nv">$o</span> <span class="p">=</span> <span class="nb">Invoke-VMScript</span> <span class="n">-VM</span> <span class="nv">$vm</span> <span class="n">-ScriptText</span> <span class="s1">&#39;systemctl restart vcf-bringup.service&#39;</span> <span class="n">-GuestUser</span> <span class="s2">&#34;root&#34;</span> <span class="n">-GuestPassword</span> <span class="nv">$CloudbuilderRootPassword</span> <span class="n">-ScriptType</span> <span class="n">Bash</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$o</span> <span class="p">=</span> <span class="nb">Invoke-VMScript</span> <span class="n">-VM</span> <span class="nv">$VM</span> <span class="n">-ScriptText</span> <span class="s2">&#34;systemctl status vcf-bringup.service&#34;</span> <span class="n">-GuestUser</span> <span class="s2">&#34;root&#34;</span> <span class="n">-GuestPassword</span> <span class="nv">$CloudbuilderRootPassword</span> <span class="n">-ScriptType</span> <span class="n">Bash</span>
</span></span><span class="line"><span class="cl"><span class="c"># Extract the service Status</span>
</span></span><span class="line"><span class="cl"><span class="nv">$outPut</span> <span class="p">=</span> <span class="p">(</span><span class="nv">$o</span><span class="p">.</span><span class="py">ScriptOutput</span> <span class="n">-split</span> <span class="s2">&#34;</span><span class="se">`n</span><span class="s2">&#34;</span><span class="p">)[</span><span class="mf">2</span><span class="p">]</span> <span class="o">-replace</span> <span class="s1">&#39;since.*&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span> <span class="o">-replace</span> <span class="s1">&#39;^\s+&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nb">Write-Host</span> <span class="s2">&#34;VCF Bringup Service:&#34;</span><span class="nv">$outPut</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Disconnect from vCenter</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nv">$deployNestedESXiVMsForMgmt</span> <span class="o">-eq</span> <span class="mf">1</span> <span class="o">-or</span> <span class="nv">$deployNestedESXiVMsForWLD</span> <span class="o">-eq</span> <span class="mf">1</span> <span class="o">-or</span> <span class="nv">$deployCloudBuilder</span> <span class="o">-eq</span> <span class="mf">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">New-LogEvent</span> <span class="s2">&#34;Disconnecting from </span><span class="nv">$VIServer</span><span class="s2"> ...&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Disconnect-VIServer</span> <span class="n">-Server</span> <span class="nv">$viConnection</span> <span class="n">-Confirm:</span><span class="vm">$false</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$EndTime</span> <span class="p">=</span> <span class="nb">Get-Date</span>
</span></span><span class="line"><span class="cl"><span class="nv">$duration</span> <span class="p">=</span> <span class="p">[</span><span class="no">math</span><span class="p">]::</span><span class="n">Round</span><span class="p">((</span><span class="nb">New-TimeSpan</span> <span class="n">-Start</span> <span class="nv">$StartTime</span> <span class="n">-End</span> <span class="nv">$EndTime</span><span class="p">).</span><span class="n">TotalMinutes</span><span class="p">,</span><span class="mf">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">New-LogEvent</span> <span class="s2">&#34;VCF Lab Deployment Complete!&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">New-LogEvent</span> <span class="s2">&#34;StartTime: </span><span class="nv">$StartTime</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">New-LogEvent</span> <span class="s2">&#34;EndTime: </span><span class="nv">$EndTime</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">New-LogEvent</span> <span class="s2">&#34;Duration: </span><span class="nv">$duration</span><span class="s2"> minutes to Deploy CloudBuilder&#34;</span></span></span></code></pre></td></tr></table>
</div>
</div></p>
<hr>
<h5 id="screen-shots">Screen Shots:</h5>
<p><small>Screen Shot of the Physical Host (MS-01), Capacity and Usage, before any installs:</p>
<ul>
<li>The server is equipped with 96 GB of physical memory. Using ESXi Tiered Memory, the total available memory is approximately 478 GB.</small></li>
</ul>
<figure><a class="lightgallery" href="/vcf-deploy-home-lab/vcf-deploy-09.png" title="/vcf-deploy-home-lab/vcf-deploy-09.png" data-thumbnail="/vcf-deploy-home-lab/vcf-deploy-09.png" data-sub-html="<h2>Click to see Larger Image of Screen Shot</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/vcf-deploy-home-lab/vcf-deploy-09.png"
            data-srcset="/vcf-deploy-home-lab/vcf-deploy-09.png, /vcf-deploy-home-lab/vcf-deploy-09.png 1.5x, /vcf-deploy-home-lab/vcf-deploy-09.png 2x"
            data-sizes="auto"
            alt="/vcf-deploy-home-lab/vcf-deploy-09.png" width="3410" height="1800" />
    </a><figcaption class="image-caption">Click to see Larger Image of Screen Shot</figcaption>
    </figure>
<hr>
<p><small>Screen Shot of the Nested ESXi install PowerShell Script output:</p>
<ul>
<li>Total Script Run Time is less than one minute</small></li>
</ul>
<figure><a class="lightgallery" href="/vcf-deploy-home-lab/vcf-deploy-10.png" title="/vcf-deploy-home-lab/vcf-deploy-10.png" data-thumbnail="/vcf-deploy-home-lab/vcf-deploy-10.png" data-sub-html="<h2>Click to see Larger Image of Screen Shot</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/vcf-deploy-home-lab/vcf-deploy-10.png"
            data-srcset="/vcf-deploy-home-lab/vcf-deploy-10.png, /vcf-deploy-home-lab/vcf-deploy-10.png 1.5x, /vcf-deploy-home-lab/vcf-deploy-10.png 2x"
            data-sizes="auto"
            alt="/vcf-deploy-home-lab/vcf-deploy-10.png" width="2098" height="910" />
    </a><figcaption class="image-caption">Click to see Larger Image of Screen Shot</figcaption>
    </figure>
<hr>
<p><small>Screen Shot of the Physical Host (MS-01), Capacity and Usage, after the Nested ESXi install:</p>
<ul>
<li>Very little CPU/Memory Usage</small></li>
</ul>
<figure><a class="lightgallery" href="/vcf-deploy-home-lab/vcf-deploy-11.png" title="/vcf-deploy-home-lab/vcf-deploy-11.png" data-thumbnail="/vcf-deploy-home-lab/vcf-deploy-11.png" data-sub-html="<h2>Click to see Larger Image of Screen Shot</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/vcf-deploy-home-lab/vcf-deploy-11.png"
            data-srcset="/vcf-deploy-home-lab/vcf-deploy-11.png, /vcf-deploy-home-lab/vcf-deploy-11.png 1.5x, /vcf-deploy-home-lab/vcf-deploy-11.png 2x"
            data-sizes="auto"
            alt="/vcf-deploy-home-lab/vcf-deploy-11.png" width="3412" height="1854" />
    </a><figcaption class="image-caption">Click to see Larger Image of Screen Shot</figcaption>
    </figure>
<hr>
<p><small>Screen Shot of the VCF Cloud Builder VM install PowerShell Script output:</p>
<ul>
<li>Total Script Run Time is ~6.5 minutes</small></li>
</ul>
<figure><a class="lightgallery" href="/vcf-deploy-home-lab/vcf-deploy-12.png" title="/vcf-deploy-home-lab/vcf-deploy-12.png" data-thumbnail="/vcf-deploy-home-lab/vcf-deploy-12.png" data-sub-html="<h2>Click to see Larger Image of Screen Shot</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/vcf-deploy-home-lab/vcf-deploy-12.png"
            data-srcset="/vcf-deploy-home-lab/vcf-deploy-12.png, /vcf-deploy-home-lab/vcf-deploy-12.png 1.5x, /vcf-deploy-home-lab/vcf-deploy-12.png 2x"
            data-sizes="auto"
            alt="/vcf-deploy-home-lab/vcf-deploy-12.png" width="2158" height="1268" />
    </a><figcaption class="image-caption">Click to see Larger Image of Screen Shot</figcaption>
    </figure>
<hr>
<p><small>Screen Shot of the Physical Host (MS-01), Capacity and Usage, after the Nested ESXi and VCF Cloud Builder install:</p>
<ul>
<li>Still very little CPU/Memory Usage</li>
<li>Both VMs moved to a vAPP by the Script</small></li>
</ul>
<figure><a class="lightgallery" href="/vcf-deploy-home-lab/vcf-deploy-13.png" title="/vcf-deploy-home-lab/vcf-deploy-13.png" data-thumbnail="/vcf-deploy-home-lab/vcf-deploy-13.png" data-sub-html="<h2>Click to see Larger Image of Screen Shot</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/vcf-deploy-home-lab/vcf-deploy-13.png"
            data-srcset="/vcf-deploy-home-lab/vcf-deploy-13.png, /vcf-deploy-home-lab/vcf-deploy-13.png 1.5x, /vcf-deploy-home-lab/vcf-deploy-13.png 2x"
            data-sizes="auto"
            alt="/vcf-deploy-home-lab/vcf-deploy-13.png" width="3408" height="1856" />
    </a><figcaption class="image-caption">Click to see Larger Image of Screen Shot</figcaption>
    </figure>
<hr>
<p><small>Screen Shot of VCF Cloud Builder Deploy wizard, step 1:</small></p>
<figure><a class="lightgallery" href="/vcf-deploy-home-lab/vcf-deploy-14.png" title="/vcf-deploy-home-lab/vcf-deploy-14.png" data-thumbnail="/vcf-deploy-home-lab/vcf-deploy-14.png" data-sub-html="<h2>Click to see Larger Image of Screen Shot</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/vcf-deploy-home-lab/vcf-deploy-14.png"
            data-srcset="/vcf-deploy-home-lab/vcf-deploy-14.png, /vcf-deploy-home-lab/vcf-deploy-14.png 1.5x, /vcf-deploy-home-lab/vcf-deploy-14.png 2x"
            data-sizes="auto"
            alt="/vcf-deploy-home-lab/vcf-deploy-14.png" width="3404" height="1628" />
    </a><figcaption class="image-caption">Click to see Larger Image of Screen Shot</figcaption>
    </figure>
<hr>
<p><small>Screen Shot of VCF Cloud Builder Deploy wizard, step 2:</small></p>
<figure><a class="lightgallery" href="/vcf-deploy-home-lab/vcf-deploy-15.png" title="/vcf-deploy-home-lab/vcf-deploy-15.png" data-thumbnail="/vcf-deploy-home-lab/vcf-deploy-15.png" data-sub-html="<h2>Click to see Larger Image of Screen Shot</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/vcf-deploy-home-lab/vcf-deploy-15.png"
            data-srcset="/vcf-deploy-home-lab/vcf-deploy-15.png, /vcf-deploy-home-lab/vcf-deploy-15.png 1.5x, /vcf-deploy-home-lab/vcf-deploy-15.png 2x"
            data-sizes="auto"
            alt="/vcf-deploy-home-lab/vcf-deploy-15.png" width="3412" height="1866" />
    </a><figcaption class="image-caption">Click to see Larger Image of Screen Shot</figcaption>
    </figure>
<hr>
<p><small>Screen Shot of VCF Cloud Builder Deploy wizard, step 3:</small></p>
<figure><a class="lightgallery" href="/vcf-deploy-home-lab/vcf-deploy-16.png" title="/vcf-deploy-home-lab/vcf-deploy-16.png" data-thumbnail="/vcf-deploy-home-lab/vcf-deploy-16.png" data-sub-html="<h2>Click to see Larger Image of Screen Shot</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/vcf-deploy-home-lab/vcf-deploy-16.png"
            data-srcset="/vcf-deploy-home-lab/vcf-deploy-16.png, /vcf-deploy-home-lab/vcf-deploy-16.png 1.5x, /vcf-deploy-home-lab/vcf-deploy-16.png 2x"
            data-sizes="auto"
            alt="/vcf-deploy-home-lab/vcf-deploy-16.png" width="3408" height="1822" />
    </a><figcaption class="image-caption">Click to see Larger Image of Screen Shot</figcaption>
    </figure>
<hr>
<p><small>Screen Shot of VCF Cloud Builder Deploy wizard, step 4:</small></p>
<figure><a class="lightgallery" href="/vcf-deploy-home-lab/vcf-deploy-17.png" title="/vcf-deploy-home-lab/vcf-deploy-17.png" data-thumbnail="/vcf-deploy-home-lab/vcf-deploy-17.png" data-sub-html="<h2>Click to see Larger Image of Screen Shot</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/vcf-deploy-home-lab/vcf-deploy-17.png"
            data-srcset="/vcf-deploy-home-lab/vcf-deploy-17.png, /vcf-deploy-home-lab/vcf-deploy-17.png 1.5x, /vcf-deploy-home-lab/vcf-deploy-17.png 2x"
            data-sizes="auto"
            alt="/vcf-deploy-home-lab/vcf-deploy-17.png" width="3410" height="1792" />
    </a><figcaption class="image-caption">Click to see Larger Image of Screen Shot</figcaption>
    </figure>
<hr>
<p><small>Screen Shot of VCF Cloud Builder Deploy wizard, step 5:</small></p>
<figure><a class="lightgallery" href="/vcf-deploy-home-lab/vcf-deploy-18.png" title="/vcf-deploy-home-lab/vcf-deploy-18.png" data-thumbnail="/vcf-deploy-home-lab/vcf-deploy-18.png" data-sub-html="<h2>Click to see Larger Image of Screen Shot</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/vcf-deploy-home-lab/vcf-deploy-18.png"
            data-srcset="/vcf-deploy-home-lab/vcf-deploy-18.png, /vcf-deploy-home-lab/vcf-deploy-18.png 1.5x, /vcf-deploy-home-lab/vcf-deploy-18.png 2x"
            data-sizes="auto"
            alt="/vcf-deploy-home-lab/vcf-deploy-18.png" width="3410" height="1668" />
    </a><figcaption class="image-caption">Click to see Larger Image of Screen Shot</figcaption>
    </figure>
<hr>
<p><small>Screen Shot of the VCF Cloud Builder - All validation is successful:</small></p>
<figure><a class="lightgallery" href="/vcf-deploy-home-lab/vcf-deploy-03.png" title="/vcf-deploy-home-lab/vcf-deploy-03.png" data-thumbnail="/vcf-deploy-home-lab/vcf-deploy-03.png" data-sub-html="<h2>Click to see Larger Image of Screen Shot</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/vcf-deploy-home-lab/vcf-deploy-03.png"
            data-srcset="/vcf-deploy-home-lab/vcf-deploy-03.png, /vcf-deploy-home-lab/vcf-deploy-03.png 1.5x, /vcf-deploy-home-lab/vcf-deploy-03.png 2x"
            data-sizes="auto"
            alt="/vcf-deploy-home-lab/vcf-deploy-03.png" width="3412" height="2484" />
    </a><figcaption class="image-caption">Click to see Larger Image of Screen Shot</figcaption>
    </figure>
<hr>
<p><small>Screen Shot of VCF Cloud Builder Deploy wizard, step 6, start the VCF SDDC Deploy:</small></p>
<figure><a class="lightgallery" href="/vcf-deploy-home-lab/vcf-deploy-19.png" title="/vcf-deploy-home-lab/vcf-deploy-19.png" data-thumbnail="/vcf-deploy-home-lab/vcf-deploy-19.png" data-sub-html="<h2>Click to see Larger Image of Screen Shot</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/vcf-deploy-home-lab/vcf-deploy-19.png"
            data-srcset="/vcf-deploy-home-lab/vcf-deploy-19.png, /vcf-deploy-home-lab/vcf-deploy-19.png 1.5x, /vcf-deploy-home-lab/vcf-deploy-19.png 2x"
            data-sizes="auto"
            alt="/vcf-deploy-home-lab/vcf-deploy-19.png" width="3404" height="2318" />
    </a><figcaption class="image-caption">Click to see Larger Image of Screen Shot</figcaption>
    </figure>
<hr>
<p><small>Screen Shot of the VCF Cloud Builder - A successful VCF deployment!</small></p>
<figure><a class="lightgallery" href="/vcf-deploy-home-lab/vcf-deploy-20.png" title="/vcf-deploy-home-lab/vcf-deploy-20.png" data-thumbnail="/vcf-deploy-home-lab/vcf-deploy-20.png" data-sub-html="<h2>Click to see Larger Image of Screen Shot</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/vcf-deploy-home-lab/vcf-deploy-20.png"
            data-srcset="/vcf-deploy-home-lab/vcf-deploy-20.png, /vcf-deploy-home-lab/vcf-deploy-20.png 1.5x, /vcf-deploy-home-lab/vcf-deploy-20.png 2x"
            data-sizes="auto"
            alt="/vcf-deploy-home-lab/vcf-deploy-20.png" width="3410" height="2450" />
    </a><figcaption class="image-caption">Click to see Larger Image of Screen Shot</figcaption>
    </figure>
<hr>
<p><small>Screen Shot of the VCF Cloud Builder - Press button to launch SDDC Manager.</small></p>
<figure><a class="lightgallery" href="/vcf-deploy-home-lab/vcf-deploy-21.png" title="/vcf-deploy-home-lab/vcf-deploy-21.png" data-thumbnail="/vcf-deploy-home-lab/vcf-deploy-21.png" data-sub-html="<h2>Click to see Larger Image of Screen Shot</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/vcf-deploy-home-lab/vcf-deploy-21.png"
            data-srcset="/vcf-deploy-home-lab/vcf-deploy-21.png, /vcf-deploy-home-lab/vcf-deploy-21.png 1.5x, /vcf-deploy-home-lab/vcf-deploy-21.png 2x"
            data-sizes="auto"
            alt="/vcf-deploy-home-lab/vcf-deploy-21.png" width="3406" height="2496" />
    </a><figcaption class="image-caption">Click to see Larger Image of Screen Shot</figcaption>
    </figure>
<hr>
<p><small>Screen Shot of the VCF SDDC Manager.</small></p>
<figure><a class="lightgallery" href="/vcf-deploy-home-lab/vcf-deploy-05.png" title="/vcf-deploy-home-lab/vcf-deploy-05.png" data-thumbnail="/vcf-deploy-home-lab/vcf-deploy-05.png" data-sub-html="<h2>Click to see Larger Image of Screen Shot</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/vcf-deploy-home-lab/vcf-deploy-05.png"
            data-srcset="/vcf-deploy-home-lab/vcf-deploy-05.png, /vcf-deploy-home-lab/vcf-deploy-05.png 1.5x, /vcf-deploy-home-lab/vcf-deploy-05.png 2x"
            data-sizes="auto"
            alt="/vcf-deploy-home-lab/vcf-deploy-05.png" width="3400" height="2422" />
    </a><figcaption class="image-caption">Click to see Larger Image of Screen Shot</figcaption>
    </figure>
<hr>
<p><small>Screen Shot of the VCF SDDC Manager - By installing version 5.2.1, I also have the opportunity to upgrade to 5.2.1.1 and learn the upgrade process:</small></p>
<figure><a class="lightgallery" href="/vcf-deploy-home-lab/vcf-deploy-06.png" title="/vcf-deploy-home-lab/vcf-deploy-06.png" data-thumbnail="/vcf-deploy-home-lab/vcf-deploy-06.png" data-sub-html="<h2>Click to see Larger Image of Screen Shot</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/vcf-deploy-home-lab/vcf-deploy-06.png"
            data-srcset="/vcf-deploy-home-lab/vcf-deploy-06.png, /vcf-deploy-home-lab/vcf-deploy-06.png 1.5x, /vcf-deploy-home-lab/vcf-deploy-06.png 2x"
            data-sizes="auto"
            alt="/vcf-deploy-home-lab/vcf-deploy-06.png" width="3404" height="2434" />
    </a><figcaption class="image-caption">Click to see Larger Image of Screen Shot</figcaption>
    </figure>
<hr>
<p><small>Screen Shot of the VCF SDDC Manager - You can see that the performance is good for a Home Lab environment:</small></p>
<figure><a class="lightgallery" href="/vcf-deploy-home-lab/vcf-deploy-07.png" title="/vcf-deploy-home-lab/vcf-deploy-07.png" data-thumbnail="/vcf-deploy-home-lab/vcf-deploy-07.png" data-sub-html="<h2>Click to see Larger Image of Screen Shot</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/vcf-deploy-home-lab/vcf-deploy-07.png"
            data-srcset="/vcf-deploy-home-lab/vcf-deploy-07.png, /vcf-deploy-home-lab/vcf-deploy-07.png 1.5x, /vcf-deploy-home-lab/vcf-deploy-07.png 2x"
            data-sizes="auto"
            alt="/vcf-deploy-home-lab/vcf-deploy-07.png" width="3406" height="2426" />
    </a><figcaption class="image-caption">Click to see Larger Image of Screen Shot</figcaption>
    </figure>
<hr>
<p><small>Screen Shot of the Physical Host (MS-01), Capacity and Usage, after the installs are complete:</p>
<ul>
<li>CPU/Memory/Storage all look OK</small></li>
</ul>
<figure><a class="lightgallery" href="/vcf-deploy-home-lab/vcf-deploy-22.png" title="/vcf-deploy-home-lab/vcf-deploy-22.png" data-thumbnail="/vcf-deploy-home-lab/vcf-deploy-22.png" data-sub-html="<h2>Click to see Larger Image of Screen Shot</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/vcf-deploy-home-lab/vcf-deploy-22.png"
            data-srcset="/vcf-deploy-home-lab/vcf-deploy-22.png, /vcf-deploy-home-lab/vcf-deploy-22.png 1.5x, /vcf-deploy-home-lab/vcf-deploy-22.png 2x"
            data-sizes="auto"
            alt="/vcf-deploy-home-lab/vcf-deploy-22.png" width="3406" height="1848" />
    </a><figcaption class="image-caption">Click to see Larger Image of Screen Shot</figcaption>
    </figure>
<hr>
<p><small>Screen Shot of the Physical ESXi Host vSwitch Security settings that is running the nested ESXi Host:</small></p>
<figure><a class="lightgallery" href="/vcf-deploy-home-lab/vcf-deploy-08.png" title="/vcf-deploy-home-lab/vcf-deploy-08.png" data-thumbnail="/vcf-deploy-home-lab/vcf-deploy-08.png" data-sub-html="<h2>Click to see Larger Image of Screen Shot</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/vcf-deploy-home-lab/vcf-deploy-08.png"
            data-srcset="/vcf-deploy-home-lab/vcf-deploy-08.png, /vcf-deploy-home-lab/vcf-deploy-08.png 1.5x, /vcf-deploy-home-lab/vcf-deploy-08.png 2x"
            data-sizes="auto"
            alt="/vcf-deploy-home-lab/vcf-deploy-08.png" width="3182" height="2450" />
    </a><figcaption class="image-caption">Click to see Larger Image of Screen Shot</figcaption>
    </figure>
<hr>
<h5 id="lessons-learned">Lessons Learned:</h5>
<ul>
<li>Update the security settings on the vSwitch of the physical ESXi hosts running the nested ESXi hosts to ensure proper configuration (Refer to the screenshot above.)</li>
<li><strong>MAKE SURE DNS IS SETUP WITH THE NAMES AND IPs YOU SPECIFY IN THE SCRIPT!</strong> If the install fails, it is probably a DNS issue!</li>
<li>This script takes approximately 1.25 to 1.5 hours to run and create a VCF SDDC Manager environment.</li>
<li>If monitoring the logs, expect periods with no new log entries. Be patient—the process will complete.
<ul>
<li>Example commands to monitor the install logs of Cloud Builder:
<ul>
<li><code>tail -f -n 45 /var/log/vmware/vcf/bringup/vcf-bringup.log</code></li>
<li><code>less /var/log/vmware/vcf/bringup/vcf-bringup.log</code></li>
</ul>
</li>
</ul>
</li>
<li>I have run these scripts multiple times, and they have completed successfully.</li>
<li>Command to make sure the changes to allow a single ESXi can be used for VCF SDDC Manager on the Cloud Builder VM:
<ul>
<li>The script will complete this step. This is the command to run if you want to verify.</li>
<li><code>cat /etc/vmware/vcf/bringup/application.properties</code></li>
</ul>
</li>
<li>Command to restart the vcf-bringup.service on the Cloud Builder VM:
<ul>
<li>The script will complete this step. This is the command to run if you want to run manually.</li>
<li><code>systemctl restart vcf-bringup.service</code></li>
</ul>
</li>
<li>Check out <a href="https://www.brockpeterson.com" target="_blank" rel="noopener noreffer ">Brock Peterson</a> blogs for example VCF Operations Dashboards to monitor your VCF environments. Best VCF Operations Blog site available!</li>
<li>I also have the example code saved in my <a href="https://github.com/dalehassinger/unlocking-the-potential/tree/main/" target="_blank" rel="noopener noreffer ">GitHub Repository</a></li>
<li>In this blog, I used a single Nested ESXi host to keep things simple, and the performance has been fine for a home lab setup.
<ul>
<li>If you want to expand your environment, you can add additional Nested ESXi Hosts. You can either modify the deployment script or manually add more ESXi hosts to the SDDC Manager after the installation to better understand the process.</li>
</ul>
</li>
<li>After the VCF SDDC Manager is installed and running, you can safely delete the Cloud Builder from vCenter to free up space and resources.</li>
</ul>
<hr>
<h4 id="downloading-the-nested-esxi-virtual-appliances-from-vmware-fling-site">Downloading the Nested ESXi Virtual Appliances from VMware Fling Site</h4>
<p>For those looking to deploy a Nested ESXi Virtual Appliance, VMware provides pre-configured templates available on their Fling site.</p>
<p>➡️ <a href="https://community.broadcom.com/flings/home" target="_blank" rel="noopener noreffer ">Click here to access the downloads</a></p>
<h5 id="important-note-for-macos-users">Important Note for macOS Users</h5>
<p>The Nested ESXi Virtual Appliance downloads are packaged as ZIP files. However, do not double-click to unpack them on macOS, as it may lead to issues with the extracted contents.</p>
<p>Instead, use the command line to properly extract the ZIP file:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">unzip Nested_ESXi8_0u3c_Appliance_Template_v1_ova-dl.zip
</span></span></code></pre></td></tr></table>
</div>
</div><hr>
<p><strong>Links to Help with Nested ESXi and VCF on NUC:</strong></p>
<ul>
<li><a href="https://williamlam.com/2023/05/refresher-on-nested-esxi-networking-requirements.html" target="_blank" rel="noopener noreffer ">Refresher on Nested ESXi Networking Requirements</a></li>
<li><a href="https://williamlam.com/2023/06/vmware-cloud-foundation-5-0-running-on-intel-nuc.html" target="_blank" rel="noopener noreffer ">VMware Cloud Foundation 5.0 running on Intel NUC</a></li>
<li><a href="https://williamlam.com/2023/02/vmware-cloud-foundation-on-intel-nuc.html" target="_blank" rel="noopener noreffer ">VMware Cloud Foundation on Intel NUC?</a></li>
</ul>
<hr>
<div class="details admonition info open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-info-circle fa-fw" aria-hidden="true"></i>Info<i class="details-icon fas fa-angle-right fa-fw" aria-hidden="true"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content">In my blogs, I often emphasize that there are multiple methods to achieve the same objective. This article presents just one of the many ways you can tackle this task. I&rsquo;ve shared what I believe to be an effective approach for this particular use case, but keep in mind that every organization and environment varies. There&rsquo;s no definitive right or wrong way to accomplish the tasks discussed in this article.</div>
        </div>
    </div>
<hr>
<div class="details admonition warning open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-exclamation-triangle fa-fw" aria-hidden="true"></i>Lab<i class="details-icon fas fa-angle-right fa-fw" aria-hidden="true"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content">Always test new setups and processes, like those discussed in this blog, in a lab environment before implementing them in a production environment.</div>
        </div>
    </div>
<hr>
<div class="details admonition tip open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-lightbulb fa-fw" aria-hidden="true"></i>Tips and Tricks<i class="details-icon fas fa-angle-right fa-fw" aria-hidden="true"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content">If you found this blog article helpful and it assisted you, consider buying me a coffee to kickstart my day.</div>
        </div>
    </div>
<center>
<script type="text/javascript" src="https://cdnjs.buymeacoffee.com/1.0.0/button.prod.min.js" data-name="bmc-button" data-slug="dalehassinger" data-color="#FFDD00" data-emoji=""  data-font="Cookie" data-text="Buy me a coffee" data-outline-color="#000000" data-font-color="#000000" data-coffee-color="#ffffff" ></script>
</center>
<hr>
<div style="font-weight: bold;">Comments:</div>
<div style="height: 20px;"></div>
<div
  id="cusdis_thread"
  data-host="https://cusdis.com"
  data-app-id="c49f7fae-719b-4753-a518-a57e5321d7c1"
  data-page-id="posts/vcf-deploy-home-lab/index.en.md"
  data-page-url="https://www.vcrocs.info/vcf-deploy-home-lab/"
  data-page-title="VCF Deploy | Scripted Install | Home Lab"
></div>
<script async defer src="https://cusdis.com/js/cusdis.es.js"></script></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2024-12-26</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="https://www.vcrocs.info/vcf-deploy-home-lab/" data-title="VCF Deploy | Scripted Install | Home Lab" data-via="dalehassinger" data-hashtags="VCF,Automation,Operations,PowerShell"><i class="fab fa-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="https://www.vcrocs.info/vcf-deploy-home-lab/" data-hashtag="VCF"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Linkedin" data-sharer="linkedin" data-url="https://www.vcrocs.info/vcf-deploy-home-lab/"><i class="fab fa-linkedin fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/vcf/">VCF</a>,&nbsp;<a href="/tags/automation/">Automation</a>,&nbsp;<a href="/tags/operations/">Operations</a>,&nbsp;<a href="/tags/powershell/">PowerShell</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/2024-top-blogs-and-stats/" class="prev" rel="prev" title="Top Blog Highlights of 2024"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>Top Blog Highlights of 2024</a>
            <a href="/vcf-automation-input-array/" class="next" rel="next" title="VCF Automation | Input Arrays">VCF Automation | Input Arrays<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
<div id="comments"></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Designed | Developed By vCROCS</div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2019 - 2025</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://www.vcrocs.info" target="_blank">Dale Hassinger</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://www.vCROCS.info" target="_blank">www.vCROCS.info</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/css/lightgallery-bundle.min.css"><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/lightgallery.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/thumbnail/lg-thumbnail.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/zoom/lg-zoom.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":50},"comment":{},"lightgallery":true,"search":{"highlightTag":"em","lunrIndexURL":"/index.json","maxResultLength":10,"noResultsFound":"No results found","snippetLength":30,"type":"lunr"}};</script><script type="text/javascript" src="/js/theme.min.js"></script><script type="text/javascript">
            window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());
            gtag('config', 'G-KSLC6FHF36');
        </script><script type="text/javascript" src="https://www.googletagmanager.com/gtag/js?id=G-KSLC6FHF36" async></script></body>
</html>
